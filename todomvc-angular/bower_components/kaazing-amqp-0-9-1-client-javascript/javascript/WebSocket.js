/**
 * Copyright (c) 2007-2014 Kaazing Corporation. All rights reserved.
 * 
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * 
 *   http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
function URI(a){a=a||"";var b=0,c=a.indexOf("://");if(-1!=c){this.scheme=a.slice(0,c),b=c+3;var d=a.indexOf("/",b);-1==d&&(d=a.length,a+="/");var e=a.slice(b,d);this.authority=e,b=d,this.host=e;var f=e.indexOf(":");if(-1!=f&&(this.host=e.slice(0,f),this.port=parseInt(e.slice(f+1),10),isNaN(this.port)))throw new Error("Invalid URI syntax")}var g=a.indexOf("?",b);-1!=g&&(this.path=a.slice(b,g),b=g+1);var h=a.indexOf("#",b);-1!=h?(-1!=g?this.query=a.slice(b,h):this.path=a.slice(b,h),b=h+1,this.fragment=a.slice(b)):-1!=g?this.query=a.slice(b):this.path=a.slice(b)}var Kaazing=Kaazing||{};"function"!=typeof Kaazing.namespace&&(Kaazing.namespace=function(a){var b=a.split("."),c=Kaazing;"Kaazing"===b[0]&&(b=b.slice(1));for(var d=0;d<b.length;d++)"undefined"==typeof c[b[d]]&&(c[b[d]]={}),c=c[b[d]];return c});var browser=null;if("undefined"!=typeof ActiveXObject)browser=-1!=navigator.userAgent.indexOf("MSIE 10")?"chrome":"ie";else if(-1!=navigator.userAgent.indexOf("Trident/7")&&-1!=navigator.userAgent.indexOf("rv:11"))browser="chrome";else if("[object Opera]"==Object.prototype.toString.call(window.opera))browser="opera";else if(-1!=navigator.vendor.indexOf("Apple"))browser="safari",(-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("iPhone"))&&(browser.ios=!0);else if(-1!=navigator.vendor.indexOf("Google"))browser=-1!=navigator.userAgent.indexOf("Android")&&-1==navigator.userAgent.indexOf("Chrome")?"android":"chrome";else{if("Gecko"!=navigator.product||!window.find||navigator.savePreferences)throw new Error("couldn't detect browser");browser="firefox"}switch(browser){case"ie":!function(){function a(a,b,c,d){if(d)throw new Error("Not implemented");var e=a[b]||{};a[b]=e,e[c]=c}function b(a,b,c,d){if(d)throw new Error("Not implemented");var e=a[b]||{};delete e[c]}function c(a,b){var c=b.type,d=a[c]||{};for(var e in d)if(d.hasOwnProperty(e)&&"function"==typeof d[e])try{d[e](b)}catch(f){}}if(void 0===document.createEvent){var d=function(){};d.prototype.initEvent=function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},document.createEvent=function(a){if("Events"!=a)throw new Error("Unsupported event name: "+a);return new d}}if(document._w_3_c_d_o_m_e_v_e_n_t_s_createElement=document.createElement,document.createElement=function(d){var e=this._w_3_c_d_o_m_e_v_e_n_t_s_createElement(d);if(void 0===e.addEventListener){var f={};e.addEventListener=function(b,c,d){return e.attachEvent("on"+b,c),a(f,b,c,d)},e.removeEventListener=function(a,c,d){return b(f,a,c,d)},e.dispatchEvent=function(a){return c(f,a)}}return e},void 0===window.addEventListener){var e=document.createElement("div"),f="undefined"==typeof postMessage;window.addEventListener=function(a,b,c){f&&"message"==a?e.addEventListener(a,b,c):window.attachEvent("on"+a,b)},window.removeEventListener=function(a,b,c){f&&"message"==a?e.removeEventListener(a,b,c):window.detachEvent("on"+a,b)},window.dispatchEvent=function(a){f&&"message"==a.type?e.dispatchEvent(a):window.fireEvent("on"+a.type,a)}}}();break;case"chrome":case"android":case"safari":if("undefined"==typeof window.postMessage&&"undefined"==typeof window.dispatchEvent&&"function"==typeof document.dispatchEvent){window.dispatchEvent=function(a){document.dispatchEvent(a)};var addEventListener0=window.addEventListener;window.addEventListener=function(a,b,c){"message"===a?document.addEventListener(a,b,c):addEventListener0.call(window,a,b,c)};var removeEventListener0=window.removeEventListener;window.removeEventListener=function(a,b,c){"message"===a?document.removeEventListener(a,b,c):removeEventListener0.call(window,a,b,c)}}break;case"opera":var addEventListener0=window.addEventListener;window.addEventListener=function(a,b,c){var d=b;"message"===a&&(d=function(a){if(void 0===a.origin&&void 0!==a.uri){var c=new URI(a.uri);delete c.path,delete c.query,delete c.fragment,a.origin=c.toString()}return b(a)},b._$=d),addEventListener0.call(window,a,d,c)};var removeEventListener0=window.removeEventListener;window.removeEventListener=function(a,b,c){var d=b;"message"===a&&(d=b._$),removeEventListener0.call(window,a,d,c)}}!function(){var a=URI.prototype;a.toString=function(){var a=[],b=this.scheme;if(void 0!==b){a.push(b),a.push("://"),a.push(this.host);var c=this.port;void 0!==c&&(a.push(":"),a.push(c.toString()))}return void 0!==this.path&&a.push(this.path),void 0!==this.query&&(a.push("?"),a.push(this.query)),void 0!==this.fragment&&(a.push("#"),a.push(this.fragment)),a.join("")};var b={http:80,ws:80,https:443,wss:443};URI.replaceProtocol=function(a,b){var c=a.indexOf("://");return c>0?b+a.substr(c):""}}(),function(){Base64={},Base64.encode=function(b){for(var c=[],d,e,f;b.length;)switch(b.length){case 1:d=b.shift(),c.push(a[d>>2&63]),c.push(a[d<<4&48]),c.push("="),c.push("=");break;case 2:d=b.shift(),e=b.shift(),c.push(a[d>>2&63]),c.push(a[d<<4&48|e>>4&15]),c.push(a[e<<2&60]),c.push("=");break;default:d=b.shift(),e=b.shift(),f=b.shift(),c.push(a[d>>2&63]),c.push(a[d<<4&48|e>>4&15]),c.push(a[e<<2&60|f>>6&3]),c.push(a[63&f])}return c.join("")},Base64.decode=function(a){if(0===a.length)return[];if(a.length%4!==0)throw new Error("Invalid base64 string (must be quads)");for(var c=[],d=0;d<a.length;d+=4){var e=a.charAt(d),f=a.charAt(d+1),g=a.charAt(d+2),h=a.charAt(d+3),i=b[e],j=b[f],k=b[g],l=b[h];c.push(i<<2&252|j>>4&3),"="!=g&&(c.push(j<<4&240|k>>2&15),"="!=h&&c.push(k<<6&192|63&l))}return c};for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),b={"=":0},c=0;c<a.length;c++)b[a[c]]=c;"undefined"==typeof window.btoa&&(window.btoa=function(a){for(var b=a.split(""),c=0;c<b.length;c++)b[c]=b[c].charCodeAt();return Base64.encode(b)},window.atob=function(a){for(var b=Base64.decode(a),c=0;c<b.length;c++)b[c]=String.fromCharCode(b[c]);return b.join("")})}(),function(a){if("undefined"==typeof a.ByteOrder){var b=function(){},c=b.prototype;c.toString=function(){throw new Error("Abstract")};var d=function(a){return 255&a},e=function(a){return 128&a?-256|a:a},f=function(a){return[a>>8&255,255&a]},g=function(a,b){return e(a)<<8|255&b},h=function(a,b){return(255&a)<<8|255&b},i=function(a,b,c){return(255&a)<<16|(255&b)<<8|255&c},j=function(a){return[a>>16&255,a>>8&255,255&a]},k=function(a,b,c){return(255&a)<<16|(255&b)<<8|255&c},l=function(a){return[a>>24&255,a>>16&255,a>>8&255,255&a]},m=function(a,b,c,d){return e(a)<<24|(255&b)<<16|(255&c)<<8|255&d},n=function(a,b,c,d){var e=h(a,b),f=h(c,d);return 65536*e+f};b.BIG_ENDIAN=function(){var a=function(){};a.prototype=new b;var c=a.prototype;return c._toUnsignedByte=d,c._toByte=e,c._fromShort=f,c._toShort=g,c._toUnsignedShort=h,c._toUnsignedMediumInt=i,c._fromMediumInt=j,c._toMediumInt=k,c._fromInt=l,c._toInt=m,c._toUnsignedInt=n,c.toString=function(){return"<ByteOrder.BIG_ENDIAN>"},new a}(),b.LITTLE_ENDIAN=function(){var a=function(){};a.prototype=new b;var c=a.prototype;return c._toByte=e,c._toUnsignedByte=d,c._fromShort=function(a){return f(a).reverse()},c._toShort=function(a,b){return g(b,a)},c._toUnsignedShort=function(a,b){return h(b,a)},c._toUnsignedMediumInt=function(a,b,c){return i(c,b,a)},c._fromMediumInt=function(a){return j(a).reverse()},c._toMediumInt=function(a,b,c,d,e,f){return k(f,e,d,c,b,a)},c._fromInt=function(a){return l(a).reverse()},c._toInt=function(a,b,c,d){return m(d,c,b,a)},c._toUnsignedInt=function(a,b,c,d){return n(d,c,b,a)},c.toString=function(){return"<ByteOrder.LITTLE_ENDIAN>"},new a}(),a.ByteOrder=b}}(Kaazing),function(a){function b(a,b,c){for(var d=a.array,e=0;e<c.length;e++)d[e+b]=255&c[e]}function c(a,b){return a.autoExpand&&a.expand(b),a}function d(a,b){var c=a.position+b;if(c>a.limit)throw new Error("Buffer underflow");return a}function e(a,b,c){var d=b+c;if(0>b||d>a.limit)throw new Error("Index out of bounds");return a}function f(a,b,c){var d=b+c;if(0>b||d>a.limit)throw new Error("Index out of bounds");return a}if("undefined"==typeof a.ByteBuffer){var g=function(b){this.array=b||[],this._mark=-1,this.limit=this.capacity=this.array.length,this.order=a.ByteOrder.BIG_ENDIAN};g.allocate=function(a){var b=new g;return b.capacity=a,b.limit=a,b},g.wrap=function(a){return new g(a)};var h=g.prototype;h.autoExpand=!0,h.capacity=0,h.position=0,h.limit=0,h.order=a.ByteOrder.BIG_ENDIAN,h.array=[],h.mark=function(){return this._mark=this.position,this},h.reset=function(){var a=this._mark;if(0>a)throw new Error("Invalid mark");return this.position=a,this},h.compact=function(){return this.array.splice(0,this.position),this.limit-=this.position,this.position=0,this},h.duplicate=function(){var a=new g(this.array);return a.position=this.position,a.limit=this.limit,a.capacity=this.capacity,a},h.fill=function(a){for(c(this,a);a-->0;)this.put(0);return this},h.fillWith=function(a,b){for(c(this,b);b-->0;)this.put(a);return this},h.indexOf=function(a){for(var b=this.limit,c=this.array,d=this.position;b>d;d++)if(c[d]==a)return d;return-1},h.put=function(a){return c(this,1),this.array[this.position++]=255&a,this},h.putAt=function(a,b){return f(this,a,1),this.array[a]=255&b,this},h.putUnsigned=function(a){return c(this,1),this.array[this.position++]=255&a,this},h.putUnsignedAt=function(a,b){return f(this,a,1),this.array[a]=255&b,this},h.putShort=function(a){return c(this,2),b(this,this.position,this.order._fromShort(a)),this.position+=2,this},h.putShortAt=function(a,c){return f(this,a,2),b(this,a,this.order._fromShort(c)),this},h.putUnsignedShort=function(a){return c(this,2),b(this,this.position,this.order._fromShort(65535&a)),this.position+=2,this},h.putUnsignedShortAt=function(a,c){return f(this,a,2),b(this,a,this.order._fromShort(65535&c)),this},h.putMediumInt=function(a){return c(this,3),this.putMediumIntAt(this.position,a),this.position+=3,this},h.putMediumIntAt=function(a,b){return this.putBytesAt(a,this.order._fromMediumInt(b)),this},h.putInt=function(a){return c(this,4),b(this,this.position,this.order._fromInt(a)),this.position+=4,this},h.putIntAt=function(a,c){return f(this,a,4),b(this,a,this.order._fromInt(c)),this},h.putUnsignedInt=function(a){return c(this,4),this.putUnsignedIntAt(this.position,4294967295&a),this.position+=4,this},h.putUnsignedIntAt=function(a,b){return f(this,a,4),this.putIntAt(a,4294967295&b),this},h.putString=function(a,b){return b.encode(a,this),this},h.putPrefixedString=function(a,b,d){if("undefined"==typeof d||"undefined"==typeof d.encode)throw new Error("ByteBuffer.putPrefixedString: character set parameter missing");if(0===a)return this;c(this,a);var e=b.length;switch(a){case 1:this.put(e);break;case 2:this.putShort(e);break;case 4:this.putInt(e)}return d.encode(b,this),this},h.putBytes=function(a){return c(this,a.length),b(this,this.position,a),this.position+=a.length,this},h.putBytesAt=function(a,c){return f(this,a,c.length),b(this,a,c),this},h.putByteArray=function(a){c(this,a.byteLength);for(var b=new Uint8Array(a),d=0;d<b.byteLength;d++)this.putAt(this.position+d,255&b[d]);return this.position+=a.byteLength,this},h.putBuffer=function(a){var b=a.remaining();c(this,b);for(var d=a.array,e=a.position,f=this.position,g=0;b>g;g++)this.array[g+f]=d[g+e];return this.position+=b,this},h.putBufferAt=function(a,b){var d=b.remaining();c(this,d);for(var e=b.array,f=b.position,g=this.position,h=0;d>h;h++)this.array[h+g]=e[h+f];return this},h.get=function(){return d(this,1),this.order._toByte(this.array[this.position++])},h.getAt=function(a){return e(this,a,1),this.order._toByte(this.array[a])},h.getUnsigned=function(){d(this,1);var a=this.order._toUnsignedByte(this.array[this.position++]);return a},h.getUnsignedAt=function(a){return e(this,a,1),this.order._toUnsignedByte(this.array[a])},h.getBytes=function(a){d(this,a);for(var b=new Array,c=0;a>c;c++)b.push(this.order._toByte(this.array[c+this.position]));return this.position+=a,b},h.getBytesAt=function(a,b){e(this,a,b);for(var c=new Array,d=this.array,f=0;b>f;f++)c.push(d[f+a]);return c},h.getBlob=function(b){var c=this.array.slice(this.position,b);return this.position+=b,a.BlobUtils.fromNumberArray(c)},h.getBlobAt=function(b,c){var d=this.getBytesAt(b,c);return a.BlobUtils.fromNumberArray(d)},h.getArrayBuffer=function(a){var b=new Uint8Array(a);return b.set(this.array.slice(this.position,a)),this.position+=a,b.buffer},h.getShort=function(){d(this,2);var a=this.getShortAt(this.position);return this.position+=2,a},h.getShortAt=function(a){e(this,a,2);var b=this.array;return this.order._toShort(b[a++],b[a++])},h.getUnsignedShort=function(){d(this,2);var a=this.getUnsignedShortAt(this.position);return this.position+=2,a},h.getUnsignedShortAt=function(a){e(this,a,2);var b=this.array;return this.order._toUnsignedShort(b[a++],b[a++])},h.getUnsignedMediumInt=function(){var a=this.array;return this.order._toUnsignedMediumInt(a[this.position++],a[this.position++],a[this.position++])},h.getMediumInt=function(){var a=this.getMediumIntAt(this.position);return this.position+=3,a},h.getMediumIntAt=function(a){var b=this.array;return this.order._toMediumInt(b[a++],b[a++],b[a++])},h.getInt=function(){d(this,4);var a=this.getIntAt(this.position);return this.position+=4,a},h.getIntAt=function(a){e(this,a,4);var b=this.array;return this.order._toInt(b[a++],b[a++],b[a++],b[a++])},h.getUnsignedInt=function(){d(this,4);var a=this.getUnsignedIntAt(this.position);return this.position+=4,a},h.getUnsignedIntAt=function(a){e(this,a,4);var b=this.array;return this.order._toUnsignedInt(b[a++],b[a++],b[a++],b[a++])},h.getPrefixedString=function(a,b){var c=0;switch(a||2){case 1:c=this.getUnsigned();break;case 2:c=this.getUnsignedShort();break;case 4:c=this.getInt()}if(0===c)return"";var d=this.limit;try{return this.limit=this.position+c,b.decode(this)}finally{this.limit=d}},h.getString=function(a){try{return a.decode(this)}finally{this.position=this.limit}},h.slice=function(){return new g(this.array.slice(this.position,this.limit))},h.flip=function(){return this.limit=this.position,this.position=0,this._mark=-1,this},h.rewind=function(){return this.position=0,this._mark=-1,this},h.clear=function(){return this.position=0,this.limit=this.capacity,this._mark=-1,this},h.remaining=function(){return this.limit-this.position},h.hasRemaining=function(){return this.limit>this.position},h.skip=function(a){return this.position+=a,this},h.getHexDump=function(){var a=this.array,b=this.position,c=this.limit;if(b==c)return"empty";for(var d=[],e=b;c>e;e++){var f=(a[e]||0).toString(16);1==f.length&&(f="0"+f),d.push(f)}return d.join(" ")},h.toString=h.getHexDump,h.expand=function(a){return this.expandAt(this.position,a)},h.expandAt=function(a,b){var c=a+b;return c>this.capacity&&(this.capacity=c),c>this.limit&&(this.limit=c),this},a.ByteBuffer=g}}(Kaazing),function(a){if("undefined"==typeof a.Charset){var b=function(){},c=b.prototype;c.decode=function(a){},c.encode=function(a,b){},b.UTF8=function(){function a(){}function c(a){if(0===(128&a))return 1;if(0===(32&a))return 2;if(0===(16&a))return 3;if(0===(8&a))return 4;throw new Error("Invalid UTF-8 bytes")}a.prototype=new b;var d=a.prototype;return d.decode=function(a){for(var b=a.remaining(),d=1e4>b,e=[],f=a.array,g=a.position,h=g+b,i,j,k,l,m=g;h>m;m++){i=255&f[m];var n=c(i),o=h-m;if(n>o)break;var p=null;switch(n){case 1:p=i;break;case 2:m++,j=255&f[m],p=(31&i)<<6|63&j;break;case 3:m++,j=255&f[m],m++,k=255&f[m],p=(15&i)<<12|(63&j)<<6|63&k;break;case 4:m++,j=255&f[m],m++,k=255&f[m],m++,l=255&f[m],p=(7&i)<<18|(63&j)<<12|(63&k)<<6|63&l}e.push(d?p:String.fromCharCode(p))}return d?String.fromCharCode.apply(null,e):e.join("")},d.encode=function(a,b){for(var c=b.position,d=c,e=b.array,f=0;f<a.length;f++){var g=a.charCodeAt(f);if(128>g)e[c++]=g;else if(2048>g)e[c++]=g>>6|192,e[c++]=63&g|128;else if(65536>g)e[c++]=g>>12|224,e[c++]=g>>6&63|128,e[c++]=63&g|128;else{if(!(1114112>g))throw new Error("Invalid UTF-8 string");e[c++]=g>>18|240,e[c++]=g>>12&63|128,e[c++]=g>>6&63|128,e[c++]=63&g|128}}b.position=c,b.expandAt(c,c-d)},d.encodeAsByteArray=function(a){for(var b=new Array,c=0;c<a.length;c++){var d=a.charCodeAt(c);if(128>d)b.push(d);else if(2048>d)b.push(d>>6|192),b.push(63&d|128);else if(65536>d)b.push(d>>12|224),b.push(d>>6&63|128),b.push(63&d|128);else{if(!(1114112>d))throw new Error("Invalid UTF-8 string");b.push(d>>18|240),b.push(d>>12&63|128),b.push(d>>6&63|128),b.push(63&d|128)}}return b},d.encodeByteArray=function(a){for(var b=a.length,c=[],d=0;b>d;d++){var e=a[d];if(128>e)c.push(e);else if(2048>e)c.push(e>>6|192),c.push(63&e|128);else if(65536>e)c.push(e>>12|224),c.push(e>>6&63|128),c.push(63&e|128);else{if(!(1114112>e))throw new Error("Invalid UTF-8 string");c.push(e>>18|240),c.push(e>>12&63|128),c.push(e>>6&63|128),c.push(63&e|128)}}return String.fromCharCode.apply(null,c)},d.encodeArrayBuffer=function(a){for(var b=new Uint8Array(a),c=b.length,d=[],e=0;c>e;e++){var f=b[e];if(128>f)d.push(f);else if(2048>f)d.push(f>>6|192),d.push(63&f|128);else if(65536>f)d.push(f>>12|224),d.push(f>>6&63|128),d.push(63&f|128);else{if(!(1114112>f))throw new Error("Invalid UTF-8 string");d.push(f>>18|240),d.push(f>>12&63|128),d.push(f>>6&63|128),d.push(63&f|128)}}return String.fromCharCode.apply(null,d)},d.toByteArray=function(a){for(var b=[],d,e,f,g,h=a.length,i=0;h>i;i++){d=255&a.charCodeAt(i);var j=c(d),k=null;if(j+i>h)break;switch(j){case 1:k=d;break;case 2:i++,e=255&a.charCodeAt(i),k=(31&d)<<6|63&e;break;case 3:i++,e=255&a.charCodeAt(i),i++,f=255&a.charCodeAt(i),k=(15&d)<<12|(63&e)<<6|63&f;break;case 4:i++,e=255&a.charCodeAt(i),i++,f=255&a.charCodeAt(i),i++,g=255&a.charCodeAt(i),k=(7&d)<<18|(63&e)<<12|(63&f)<<6|63&g}b.push(255&k)}return b},new a}(),a.Charset=b}}(Kaazing),function(a){var b={};b.asString=function c(a,b,d){if(a._array);else if(FileReader){var e=new FileReader;e.readAsText(a),e.onload=function(){cb(e.result)},e.onerror=function(a){console.log(a,e)}}},b.asNumberArray=function(){var a=[],b=function(){if(a.length>0)try{var c=a.shift();c.cb(c.blob._array)}finally{a.length>0&&setTimeout(function(){b()},0)}},c=function(c,d){if(d._array)a.push({cb:c,blob:d}),1==a.length&&setTimeout(function(){b()},0);else{if(!FileReader)throw new Error("Cannot convert Blob to binary string");var e=new FileReader;e.readAsArrayBuffer(d),e.onload=function(){for(var a=new DataView(e.result),b=[],d=0;d<e.result.byteLength;d++)b.push(a.getUint8(d));c(b)}}};return c}(),b.asBinaryString=function d(a,b){if(b._array){for(var c=b._array,d=[],e=0;e<c.length;e++)d.push(String.fromCharCode(c[e]));setTimeout(function(){a(d.join(""))},0)}else{if(!FileReader)throw new Error("Cannot convert Blob to binary string");var f=new FileReader;f.readAsBinaryString?(f.readAsBinaryString(b),f.onload=function(){a(f.result)}):(f.readAsArrayBuffer(b),f.onload=function(){for(var b=new DataView(f.result),c=[],d=0;d<f.result.byteLength;d++)c.push(String.fromCharCode(b.getUint8(d)));a(c.join(""))})}},b.fromBinaryString=function e(a){for(var c=[],d=0;d<a.length;d++)c.push(a.charCodeAt(d));return b.fromNumberArray(c)},b.fromNumberArray=function f(a){return new Blob("undefined"!=typeof Uint8Array?[new Uint8Array(a)]:[a])},b.fromString=function g(c,d){d&&"native"===d&&-1!=navigator.userAgent.indexOf("Windows")&&(c=c.replace("\r\n","\n","g").replace("\n","\r\n","g"));var e=new a.ByteBuffer;a.Charset.UTF8.encode(c,e);var f=e.array;return b.fromNumberArray(f)},a.BlobUtils=b}(Kaazing);var postMessage0=function(){function a(a){this.sourceToken=g(Math.floor(Math.random()*(Math.pow(2,32)-1)),8),this.iframe=a,this.bridged=!1,this.lastWrite=0,this.lastRead=0,this.lastReadIndex=2,this.lastSyn=0,this.lastAck=0,this.queue=[],this.escapedFragments=[]}function b(){var a=this.reader.location.hash;this._lastHash!=a&&(i(this,a.substring(1)),this._lastHash=a)}function c(){var a=this.reader.document.URL;if(this._lastDocumentURL!=a){var b=a.indexOf("#");-1!=b&&(i(this,a.substring(b+1)),this._lastDocumentURL=a)}}function d(a,b){if(a.lastWrite<1&&!a.bridged&&b.parent==window){for(var c=a.iframe.src,d=c.split("#"),e=null,f=document.getElementsByTagName("meta"),g=0;g<f.length;g++)"kaazing:resources"==f[g].name&&alert('kaazing:resources is no longer supported. Please refer to the Administrator\'s Guide section entitled "Configuring a Web Server to Integrate with Kaazing Gateway"');var h=r,i=h.toString()+s+"?.kr=xsp&.kv=10.05";if(e){var j=new URI(h.toString()),d=e.split(":");j.host=d.shift(),d.length&&(j.port=d.shift()),i=j.toString()+s+"?.kr=xsp&.kv=10.05"}for(var g=0;g<f.length;g++)if("kaazing:postMessageBridgeURL"==f[g].name){var k=f[g].content,l=new URI(k),m=new URI(location.toString());if(!l.authority&&(l.host=m.host,l.port=m.port,l.scheme=m.scheme,0!=k.indexOf("/"))){var o=m.path.split("/");o.pop(),o.push(k),l.path=o.join("/")}n.BridgeURL=l.toString()}n.BridgeURL&&(i=n.BridgeURL);var p=["I",h,a.sourceToken,escape(i)];if(d.length>1){var q=d[1];p.push(escape(q))}d[1]=p.join("!"),setTimeout(function(){b.location.replace(d.join("#"))},200),a.bridged=!0}}function e(a,b){var c=a.writerURL+"#"+b;a.writer.location.replace(c)}function f(a){return parseInt(a,16)}function g(a,b){var c=a.toString(16),d=[];for(b-=c.length;b-->0;)d.push("0");return d.push(c),d.join("")}function h(a,b){var c=a.queue,d=a.lastRead;if((c.length>0||b)&&a.lastSyn>a.lastAck){var h=a.lastFrames,i=a.lastReadIndex;f(h[i])!=d&&(h[i]=g(d,8),e(a,h.join("")))}else if(c.length>0){var j=c.shift(),k=j[0];if("*"==k||k==a.targetOrigin){a.lastWrite++;var l=j[1],m=l.shift(),n=3,h=[a.targetToken,g(a.lastWrite,8),g(d,8),"F",g(m.length,4),m],i=2;if(l.length>0&&(h[n]="f",a.queue.unshift(j)),a.resendAck){var o=[a.targetToken,g(a.lastWrite-1,8),g(d,8),"a"];h=o.concat(h),i+=o.length}e(a,h.join("")),a.lastFrames=h,a.lastReadIndex=i,a.lastSyn=a.lastWrite,a.resendAck=!1}}else if(b){a.lastWrite++;var h=[a.targetToken,g(a.lastWrite,8),g(d,8),"a"],i=2;if(a.resendAck){var o=[a.targetToken,g(a.lastWrite-1,8),g(d,8),"a"];h=o.concat(h),i+=o.length}e(a,h.join("")),a.lastFrames=h,a.lastReadIndex=i,a.resendAck=!0}}function i(a,b){var c=b.substring(0,8),d=f(b.substring(8,16)),e=f(b.substring(16,24)),g=b.charAt(24);if(c!=a.sourceToken)throw new Error("postMessage emulation tampering detected");var k=a.lastRead,l=k+1;if(d==l&&(a.lastRead=l),(d==l||d==k)&&(a.lastAck=e),d==l||d==k&&"a"==g)switch(g){case"f":var m=b.substr(29,f(b.substring(25,29)));a.escapedFragments.push(m),h(a,!0);break;case"F":var n=b.substr(29,f(b.substring(25,29)));void 0!==a.escapedFragments&&(a.escapedFragments.push(n),n=a.escapedFragments.join(""),a.escapedFragments=[]);var o=unescape(n);j(o,a.target,a.targetOrigin),h(a,!0);break;case"a":b.length>25?i(a,b.substring(25)):h(a,!1);break;default:throw new Error("unknown postMessage emulation payload type: "+g)}}function j(a,b,c){var d=document.createEvent("Events");d.initEvent("message",!1,!0),d.data=a,d.origin=c,d.source=b,dispatchEvent(d)}function k(){for(var a=0,b=v.length;b>a;a++){var c=v[a];c.poll()}setTimeout(k,20)}function l(a){if(a==parent)return u.parent;if(a.parent!=window)throw new Error("Generic peer postMessage not yet implemented");for(var b=document.getElementsByTagName("iframe"),c=0;c<b.length;c++){var d=b[c];if(a==d.contentWindow)return m(d)}}function m(b){var c=b._name;void 0===c&&(c="iframe$"+String(Math.random()).substring(2),b._name=c);var d=u[c];return void 0===d&&(d=new a(b),u[c]=d),d}function n(a,b,c){if("string"!=typeof b)throw new Error("Unsupported type. Messages must be strings");if(a==window)("*"==c||c==r)&&j(b,window,r);else{var d=l(a);d.post(a,b,c)}}function o(){var a=new URI("ie"==browser?document.URL:location.href),b=a.fragment||"";if(null!=document.body&&b.length>0&&"I"==b.charAt(0)){var c=unescape(b),d=c.split("!");if("I"==d.shift()){var e=d.shift(),f=d.shift(),g=unescape(d.shift()),h=r;if(e==h)try{parent.location.hash}catch(i){document.domain=document.domain}var j=d.shift()||"";switch(browser){case"firefox":location.replace([location.href.split("#")[0],j].join("#"));break;default:location.hash=j}var k=l(parent);k.targetToken=f;var m=k.sourceToken,n=g+"#"+escape([h,f,m].join(",")),p;return p=document.createElement("iframe"),p.src=n,p.style.position="absolute",p.style.left="-10px",p.style.top="10px",p.style.visibility="hidden",p.style.width="0px",p.style.height="0px",void document.body.appendChild(p)}}setTimeout(o,20)}var p=new URI("ie"==browser?document.URL:location.href),q={http:80,https:443};null==p.port&&(p.port=q[p.scheme],p.authority=p.host+":"+p.port);var r=p.scheme+"://"+p.authority,s="/.kr";if("undefined"!=typeof postMessage)return function(a,b,c){if("string"!=typeof b)throw new Error("Unsupported type. Messages must be strings");switch("null"===c&&(c="*"),browser){case"ie":case"opera":case"firefox":setTimeout(function(){a.postMessage(b,c)},0);break;default:a.postMessage(b,c)}};var t=a.prototype;t.attach=function(a,d,e,f,g,i){this.target=a,this.targetOrigin=d,this.targetToken=e,this.reader=f,this.writer=g,this.writerURL=i;try{this._lastHash=f.location.hash,this.poll=b}catch(j){this._lastDocumentURL=f.document.URL,this.poll=c}a==parent&&h(this,!0)},t.detach=function(){this.poll=function(){},delete this.target,delete this.targetOrigin,delete this.reader,delete this.lastFragment,delete this.writer,delete this.writerURL},t.poll=function(){},t.post=function(a,b,c){d(this,a);for(var e=1e3,f=escape(b),g=[];f.length>e;){var i=f.substring(0,e);f=f.substring(e),g.push(i)}g.push(f),this.queue.push([c,g]),null!=this.writer&&this.lastAck>=this.lastSyn&&h(this,!1)};var u={},v=[];n.attach=function(a,b,c,d,e,f){var g=l(a);g.attach(a,b,c,d,e,f),v.push(g)};var w=function(a){var b=new URI("ie"==browser?document.URL:location.href),c,d={http:80,https:443};null==b.port&&(b.port=d[b.scheme],b.authority=b.host+":"+b.port);var e=unescape(b.fragment||"");if(e.length>0){var f=e.split(","),g=f.shift(),h=f.shift(),i=f.shift(),j=b.scheme+"://"+document.domain+":"+b.port,k=b.scheme+"://"+b.authority,l=g+"/.kr?.kr=xsc&.kv=10.05",m=document.location.toString().split("#")[0],n=l+"#"+escape([j,h,escape(m)].join(","));if("undefined"!=typeof ActiveXObject){c=new ActiveXObject("htmlfile"),c.open();try{c.parentWindow.opener=window}catch(o){a&&(c.domain=a),c.parentWindow.opener=window}c.write("<html>"),c.write("<body>"),a&&c.write("<script>CollectGarbage();document.domain='"+a+"';</script>"),c.write('<iframe src="'+l+'"></iframe>'),c.write("</body>"),c.write("</html>"),c.close();var p=c.body.lastChild,q=c.parentWindow,r=parent,s=r.parent.postMessage0;"undefined"!=typeof s&&(p.onload=function(){var a=p.contentWindow;a.location.replace(n),s.attach(r,g,i,q,a,l)})}else{var p=document.createElement("iframe");p.src=n,document.body.appendChild(p);var q=window,t=p.contentWindow,r=parent,s=r.parent.postMessage0;"undefined"!=typeof s&&s.attach(r,g,i,q,t,l)}}window.onunload=function(){try{var a=window.parent.parent.postMessage0;"undefined"!=typeof a&&a.detach(r)}catch(b){}"undefined"!=typeof c&&(c.parentWindow.opener=null,c.open(),c.close(),c=null,CollectGarbage())}};n.__init__=function(a,b){var c=w.toString();a.URI=URI,a.browser=browser,b||(b=""),a.setTimeout("("+c+")('"+b+"')",0)},n.bridgeURL=!1,n.detach=function(a){for(var b=l(a),c=0;c<v.length;c++)v[c]==b&&v.splice(c,1);b.detach()},window!=top&&(u.parent=new a,o());for(var x=document.getElementsByTagName("meta"),y=0;y<x.length;y++)if("kaazing:postMessage"===x[y].name){if("immediate"==x[y].content){var z=function(){for(var a=document.getElementsByTagName("iframe"),b=0;b<a.length;b++){var c=a[b];if("immediate"==c.style.KaaPostMessage){c.style.KaaPostMessage="none";var e=m(c);d(e,c.contentWindow)}}setTimeout(z,20)};setTimeout(z,20)}break}for(var y=0;y<x.length;y++)if("kaazing:postMessagePrefix"===x[y].name){var A=x[y].content;null!=A&&A.length>0&&("/"!=A.charAt(0)&&(A="/"+A),s=A)}return setTimeout(k,20),n}(),Logger=function(a){this._name=a,this._level=Logger.Level.INFO};!function(){Logger.Level={OFF:8,SEVERE:7,WARNING:6,INFO:5,CONFIG:4,FINE:3,FINER:2,FINEST:1,ALL:0};for(var a,b=document.getElementsByTagName("meta"),c=0;c<b.length;c++)if("kaazing:logging"===b[c].name){a=b[c].content;break}if(Logger._logConf={},a)for(var d=a.split(","),c=0;c<d.length;c++){var e=d[c].split("=");Logger._logConf[e[0]]=e[1]}var f={};Logger.getLogger=function(a){var b=f[a];return void 0===b&&(b=new Logger(a),f[a]=b),b};var g=Logger.prototype;g.setLevel=function(a){a&&a>=Logger.Level.ALL&&a<=Logger.Level.OFF&&(this._level=a)},g.isLoggable=function(a){for(var b in Logger._logConf)if(Logger._logConf.hasOwnProperty(b)&&this._name.match(b)){var c=Logger._logConf[b];if(c)return Logger.Level[c]<=a}return this._level<=a};var h=function(){},i={};i[Logger.Level.OFF]=h,i[Logger.Level.SEVERE]=window.console?console.error||console.log||h:h,i[Logger.Level.WARNING]=window.console?console.warn||console.log||h:h,i[Logger.Level.INFO]=window.console?console.info||console.log||h:h,i[Logger.Level.CONFIG]=window.console?console.info||console.log||h:h,i[Logger.Level.FINE]=window.console?console.debug||console.log||h:h,i[Logger.Level.FINER]=window.console?console.debug||console.log||h:h,i[Logger.Level.FINEST]=window.console?console.debug||console.log||h:h,i[Logger.Level.ALL]=window.console?console.log||h:h,g.config=function(a,b){this.log(Logger.Level.CONFIG,a,b)},g.entering=function(a,b,c){if(this.isLoggable(Logger.Level.FINER)){("chrome"==browser||"safari"==browser)&&(a=console);var d=i[Logger.Level.FINER];c?"object"==typeof d?d("ENTRY "+b,c):d.call(a,"ENTRY "+b,c):"object"==typeof d?d("ENTRY "+b):d.call(a,"ENTRY "+b)}},g.exiting=function(a,b,c){if(this.isLoggable(Logger.Level.FINER)){var d=i[Logger.Level.FINER];("chrome"==browser||"safari"==browser)&&(a=console),c?"object"==typeof d?d("RETURN "+b,c):d.call(a,"RETURN "+b,c):"object"==typeof d?d("RETURN "+b):d.call(a,"RETURN "+b)}},g.fine=function(a,b){this.log(Logger.Level.FINE,a,b)},g.finer=function(a,b){this.log(Logger.Level.FINER,a,b)},g.finest=function(a,b){this.log(Logger.Level.FINEST,a,b)},g.info=function(a,b){this.log(Logger.Level.INFO,a,b)},g.log=function(a,b,c){if(this.isLoggable(a)){var d=i[a];("chrome"==browser||"safari"==browser)&&(b=console),"object"==typeof d?d(c):d.call(b,c)}},g.severe=function(a,b){this.log(Logger.Level.SEVERE,a,b)},g.warning=function(a,b){this.log(Logger.Level.WARNING,a,b)}}();var getMetaValue=function(a){for(var b=document.getElementsByTagName("meta"),c=0;c<b.length;c++)if(b[c].name===a){var d=b[c].content;return d}},arrayCopy=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b},arrayFilter=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];b(e)&&c.push(a[d])}return c},indexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1},decodeByteString=function(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));var d=new Kaazing.ByteBuffer(b),e=getStringUnterminated(d,Kaazing.Charset.UTF8);return e},decodeArrayBuffer=function(a){for(var b=new Uint8Array(a),c=[],d=0;d<b.length;d++)c.push(b[d]);var b=new Kaazing.ByteBuffer(c),e=getStringUnterminated(b,Kaazing.Charset.UTF8);return e},decodeArrayBuffer2ByteBuffer=function(a){for(var b=new Uint8Array(a),c=[],d=0;d<b.length;d++)c.push(b[d]);return new Kaazing.ByteBuffer(c)},ESCAPE_CHAR=String.fromCharCode(127),NULL=String.fromCharCode(0),LINEFEED="\n",encodeEscapedByteString=function(a){for(var b=[];a.remaining();){var c=a.getUnsigned(),d=String.fromCharCode(c);switch(d){case ESCAPE_CHAR:b.push(ESCAPE_CHAR),b.push(ESCAPE_CHAR);break;case NULL:b.push(ESCAPE_CHAR),b.push("0");break;case LINEFEED:b.push(ESCAPE_CHAR),b.push("n");break;default:b.push(d)}}var e=b.join("");return e},encodeByteString=function(a,b){if(b)return encodeEscapedByteString(a);for(var c=a.array,d=0==a.position&&a.limit==c.length?c:a.getBytes(a.remaining()),e=!XMLHttpRequest.prototype.sendAsBinary,f=d.length-1;f>=0;f--){var g=d[f];0==g&&e?d[f]=256:0>g&&(d[f]=255&g)}var h=0,i=[];do{var j=Math.min(d.length-h,1e4);partOfBytes=d.slice(h,h+j),h+=j,i.push(String.fromCharCode.apply(null,partOfBytes))}while(h<d.length);var k=i.join("");if(d===c)for(var f=d.length-1;f>=0;f--){var g=d[f];256==g&&(d[f]=0)}return k},getStringUnterminated=function(a,b){for(var c=a.position,d=a.limit,e=a.array;d>c;)c++;try{return a.limit=c,b.decode(a)}finally{c!=d&&(a.limit=d,a.position=c+1)
}},XDRHttpDirect=function(){function a(a){this.outer=a}var b=0,c=a.prototype;return c.open=function(a,b){var c=this,d=this.outer;d.responseText="";var e=2,f=0,g=0;this._method=a,this._location=b,b+=-1==b.indexOf("?")?"?.kac=ex&.kct=application/x-message-http":"&.kac=ex&.kct=application/x-message-http",this.location=b;var h=this.xdr=new XDomainRequest,i=function(a){try{var b=h.responseText;if(2>=e){var i=b.indexOf("\r\n\r\n");if(-1==i)return;var j=b.indexOf("\r\n"),k=b.substring(0,j),l=k.match(/HTTP\/1\.\d\s(\d+)\s([^\r\n]+)/);d.status=parseInt(l[1]),d.statusText=l[2];var m=j+2;g=i+4;var n=b.substring(m,i).split("\r\n");d._responseHeaders={};for(var o=0;o<n.length;o++){var p=n[o].split(":");d._responseHeaders[p[0].replace(/^\s+|\s+$/g,"")]=p[1].replace(/^\s+|\s+$/g,"")}f=g,e=d.readyState=3,"function"==typeof c.onreadystatechange&&c.onreadystatechange(d)}var q=h.responseText.length;q>f&&(d.responseText=b.slice(g),f=q,"function"==typeof c.onprogress&&c.onprogress(d))}catch(r){c.onload(d)}};h.onprogress=i,h.onerror=function(a){d.readyState=0,"function"==typeof d.onerror&&d.onerror(d)},h.onload=function(a){3>=e&&i(a),reayState=d.readyState=4,"function"==typeof d.onreadystatechange&&d.onreadystatechange(d),"function"==typeof d.onload&&d.onload(d)},h.open("POST",b)},c.send=function(a){for(var b=this._method+" "+this.location.substring(this.location.indexOf("/",9),this.location.indexOf("&.kct"))+" HTTP/1.1\r\n",c=0;c<this.outer._requestHeaders.length;c++)b+=this.outer._requestHeaders[c][0]+": "+this.outer._requestHeaders[c][1]+"\r\n";var d=a||"";if(d.length>0||"POST"===this._method.toUpperCase()){for(var e=0,c=0;c<d.length;c++)e++,d.charCodeAt(c)>=128&&e++;b+="Content-Length: "+e+"\r\n"}b+="\r\n",b+=d,this.xdr.send(b)},c.abort=function(){this.xdr.abort()},a}(),XMLHttpBridge=function(){function a(a){this.outer=a}function b(a){switch("undefined"!=typeof a.onreadystatechange&&a.onreadystatechange(a.outer),a.outer.readyState){case 3:"undefined"!=typeof a.onprogress&&a.onprogress(a.outer);break;case 4:a.outer.status<100||a.outer.status>=500?"undefined"!=typeof a.onerror&&a.onerror(a.outer):("undefined"!=typeof a.onprogress&&a.onprogress(a.outer),"undefined"!=typeof a.onload&&a.onload(a.outer))}}function c(a){return parseInt(a,16)}function d(a,b){var c=a.toString(16),d=[];for(b-=c.length;b-->0;)d.push("0");return d.push(c),d.join("")}function e(a){var b=d(m++,8);return l[b]=a,a._id=b,b}function f(a,b){"string"!=typeof b&&(b="");for(var c=a._method.substring(0,10),e=a._location,f=a.outer._requestHeaders,g=d(a.outer.timeout,4),h=void 0!==a.outer.onprogress?"t":"f",i=["s",a._id,c.length,c,d(e.length,4),e,d(f.length,4)],j=0;j<f.length;j++){var k=f[j];i.push(d(k[0].length,4)),i.push(k[0]),i.push(d(k[1].length,4)),i.push(k[1])}i.push(d(b.length,8),b,d(g,4),h),a._pipe.post(i.join(""))}function g(a,c){function d(a){this.buffer.push(a)}function e(a){var b=this.attached[a];void 0===b&&(b={},this.attached[a]=b),void 0!==b.timerID&&(clearTimeout(b.timerID),delete b.timerID)}function f(a){var b=this.attached[a];if(void 0!==b&&void 0===b.timerID){var c=this;b.timerID=setTimeout(function(){delete c.attached[a];var b=l[a];b._pipe==q&&(delete l[a],delete b._id,delete b._pipe),postMessage0(q.iframe.contentWindow,["d",a].join(""),q.targetOrigin)},0)}}function g(){var a=r.contentWindow;a?postMessage0(a,"I",p):setTimeout(g,20)}var h=new URI(c),m=null!=h.scheme&&null!=h.authority,n=m?h.scheme:i.scheme,o=m?h.authority:i.authority;null!=o&&null==h.port&&(o=h.host+":"+j[n]);var p=n+"://"+o,q=k[p];if(void 0!==q&&("iframe"in q&&"contentWindow"in q.iframe&&"object"==typeof q.iframe.contentWindow||(q=k[p]=void 0)),void 0===q){var r=document.createElement("iframe");r.style.position="absolute",r.style.left="-10px",r.style.top="10px",r.style.visibility="hidden",r.style.width="0px",r.style.height="0px";var s=new URI(p);s.query=".kr=xs",s.path="/",r.src=s.toString(),q={targetOrigin:p,iframe:r,buffer:[],post:d,attach:e,detach:f,attached:{count:0}},k[p]=q,q.handshakeID=setTimeout(function(){k[p]=void 0,q.post=function(c){a.readyState=4,a.status=0,b(a)},q.buffer.length>0&&q.post()},3e4),document.body.appendChild(r),"undefined"==typeof postMessage&&g()}return q}function h(a){var d=a.origin,h={http:":80",https:":443"},i=d.split(":");2===i.length&&(d+=h[i[0]]);var j=k[d];if(void 0!==j&&void 0!==j.iframe&&a.source==j.iframe.contentWindow)if("I"==a.data){clearTimeout(j.handshakeID);for(var m;void 0!==(m=j.buffer.shift());)postMessage0(j.iframe.contentWindow,m,j.targetOrigin);j.post=function(a){postMessage0(j.iframe.contentWindow,a,j.targetOrigin)}}else{var m=a.data;if(m.length>=9){var n=0,o=m.substring(n,n+=1),p=m.substring(n,n+=8),q=l[p];if(void 0!==q)switch(o){case"r":for(var r={},s=c(m.substring(n,n+=2)),t=0;s>t;t++){var u=c(m.substring(n,n+=4)),v=m.substring(n,n+=u),w=c(m.substring(n,n+=4)),x=m.substring(n,n+=w);r[v]=x}var y=c(m.substring(n,n+=4)),z=c(m.substring(n,n+=2)),A=m.substring(n,n+=z);switch(y){case 301:case 302:case 307:var B=r.Location,C=a.origin;if("function"==typeof q.outer.onredirectallowed&&!q.outer.onredirectallowed(C,B))return;var p=e(q),j=g(q,B);j.attach(p),q._pipe=j,q._method="GET",q._location=B,q._redirect=!0;break;case 403:q.outer.status=y,b(q);break;default:q.outer._responseHeaders=r,q.outer.status=y,q.outer.statusText=A}break;case"p":var D=parseInt(m.substring(n,n+=1));if(q._id===p){q.outer.readyState=D;var E=c(m.substring(n,n+=8)),F=m.substring(n,n+=E);F.length>0&&(q.outer.responseText+=F),b(q)}else q._redirect&&(q._redirect=!1,f(q,""));4==D&&j.detach(p);break;case"e":q._id===p&&(q.outer.status=0,q.outer.statusText="",q.outer.readyState=4,b(q)),j.detach(p);break;case"t":q._id===p&&(q.outer.status=0,q.outer.statusText="",q.outer.readyState=4,"undefined"!=typeof q.ontimeout&&q.ontimeout()),j.detach(p)}}}}var i=new URI("ie"==browser?document.URL:location.href),j={http:80,https:443};null==i.port&&(i.port=j[i.scheme],i.authority=i.host+":"+i.port);var k={},l={},m=0,n=a.prototype;return n.open=function(a,c){var d=e(this),f=g(this,c);f.attach(d),this._pipe=f,this._method=a,this._location=c,this.outer.readyState=1,this.outer.status=0,this.outer.statusText="",this.outer.responseText="";var h=this;setTimeout(function(){h.outer.readyState=1,b(h)},0)},n.send=function(a){f(this,a)},n.abort=function(){var a=this._pipe;void 0!==a&&(a.post(["a",this._id].join("")),a.detach(this._id))},window.addEventListener("message",h,!1),a}(),XMLHttpRequest0=function(){function a(a){"undefined"!=typeof a.onreadystatechange&&a.onreadystatechange()}function b(a){"undefined"!=typeof a.onprogress&&a.onprogress()}function c(a){"undefined"!=typeof a.onerror&&a.onerror()}function d(a){"undefined"!=typeof a.onload&&a.onload()}function e(){this._requestHeaders=[],this.responseHeaders={},this.withCredentials=!1}var f=new URI("ie"==browser?document.URL:location.href),g={http:80,https:443};null==f.port&&(f.port=g[f.scheme],f.authority=f.host+":"+f.port);var h=e.prototype;return h.readyState=0,h.responseText="",h.status=0,h.statusText="",h.timeout=0,h.onreadystatechange,h.onerror,h.onload,h.onprogress,h.onredirectallowed,h.open=function(e,h,i){if(!i)throw new Error("Asynchronous is required for cross-origin XMLHttpRequest emulation");switch(this.readyState){case 0:case 4:break;default:throw new Error("Invalid ready state")}var j=this;this._method=e,this._location=h,this.readyState=1,this.status=0,this.statusText="",this.responseText="";var k,l=new URI(h);if(null==l.port&&(l.port=g[l.scheme],l.authority=l.host+":"+l.port),"ie"!=browser||"undefined"==typeof XDomainRequest||l.scheme!=f.scheme||this.withCredentials)if(l.scheme==f.scheme&&l.authority==f.authority)try{k=new XMLHttpBridge(this)}catch(m){k=new XMLHttpBridge(this)}else k=new XMLHttpBridge(this);else k=new XDRHttpDirect(this);k.onload=d,k.onprogress=b,k.onreadystatechange=a,k.onerror=c,k.open(e,h),this.xhr=k,setTimeout(function(){j.readyState>1||(j.readyState<1&&(j.readyState=1),a(j))},0)},h.setRequestHeader=function(a,b){if(1!==this.readyState)throw new Error("Invalid ready state");this._requestHeaders.push([a,b])},h.send=function(b){if(1!==this.readyState)throw new Error("Invalid ready state");var c=this;setTimeout(function(){c.readyState>2||(c.readyState<2&&(c.readyState=2),a(c))},0),this.xhr.send(b)},h.abort=function(){this.xhr.abort()},h.getResponseHeader=function(a){if(0==this.status)throw new Error("Invalid ready state");var b=this._responseHeaders;return b[a]},h.getAllResponseHeaders=function(){if(0==this.status)throw new Error("Invalid ready state");return this._responseHeaders},e}();Kaazing.Gateway=Kaazing.namespace("Gateway"),Kaazing.Gateway.URI=window.URI,Kaazing.Gateway.ByteOrder=Kaazing.ByteOrder,Kaazing.Gateway.ByteBuffer=Kaazing.ByteBuffer,Kaazing.Gateway.Charset=Kaazing.Charset,Kaazing.Gateway.BlobUtils=Kaazing.BlobUtils,function(){function a(){this.Keys=new Array}function b(){this.canHandle=function(a){return!1},this.handle=function(a,b){b(null)}}function c(a,b,c,d){this.reason=d,this.code=c,this.wasClean=b,this.type="close",this.bubbles=!0,this.cancelable=!0,this.target=a}function d(a,b,c){return{target:a,data:b,origin:c,bubbles:!0,cancelable:!0,type:"message",lastEventId:""}}var e=Kaazing,f=e.Gateway,g=e.Charset,h=e.BlobUtils,i=window.WebSocket,j=function(){function a(a,b,c){a.code=1005|b,a.reason=""|c,a._delegate.close()}function b(a,b){if("string"==typeof b)a._delegate.send(b);else if(b.byteLength||b.size)a._delegate.send(b);else{if(b.constructor!=e.ByteBuffer)throw new Error("Cannot call send() with that type");a._delegate.send(b.getArrayBuffer(b.remaining()))}}function c(a,b){setTimeout(function(){a._listener.connectionFailed(a.parent)},0)}function d(a,b){var c;if("undefined"!=typeof b.data.byteLength)c=decodeArrayBuffer2ByteBuffer(b.data);else{if(c=e.ByteBuffer.allocate(b.data.length),a.parent._isBinary&&a.parent._balanced>1)for(var d=0;d<b.data.length;d++)c.put(b.data.charCodeAt(d));else c.putString(b.data,g.UTF8);c.flip()}return c}function f(a,b){a.lastMessageTimestamp=(new Date).getTime(),"string"==typeof b.data?a._listener.textMessageReceived(a.parent,b.data):a._listener.binaryMessageReceived(a.parent,b.data)}function h(a,b){m(a),r?a._listener.connectionClosed(a.parent,!0,a.code,a.reason):a._listener.connectionClosed(a.parent,b.wasClean,b.code,b.reason)}function j(a,b){a._listener.connectionError(a.parent,b)}function k(a,b){r&&(a._delegate.protocol=a._requestedProtocol),a._listener.connectionOpened(a.parent,a._delegate.protocol)}function l(a){var b=a._delegate;b.onopen=function(b){k(a,b)},b.onmessage=function(b){f(a,b)},b.onclose=function(b){h(a,b)},b.onerror=function(b){j(a,b)},a.readyState=function(){return b.readyState}}function m(a){var b=a._delegate;b.onmessage=void 0,b.onclose=void 0,b.onopen=void 0,b.onerror=void 0,a.readyState=db.CLOSED}function n(a,b){p(a),a.idleTimer=setTimeout(function(){o(a)},b)}function o(a){var b=(new Date).getTime(),c=b-a.lastMessageTimestamp,d=a.idleTimeout;if(c>d)try{var e=a._delegate;e&&(m(a),e.close())}finally{a._listener.connectionClosed(a.parent,!1,1006,"")}else n(a,d-c)}function p(a){null!=a.idleTimer&&(clearTimeout(a.idleTimer),a.IdleTimer=null)}var q=function(){this.parent,this._listener,this.code=1005,this.reason=""},r="safari"==browser&&"undefined"==typeof i.CLOSING,s="android"==browser,t=q.prototype;return t.connect=function(a,b){if("undefined"==typeof i||s)return void c(this);0==a.indexOf("javascript:")&&(a=a.substr("javascript:".length));var d=a.indexOf("?");-1!=d?/[\?&]\.kl=Y/.test(a.substring(d))||(a+="&.kl=Y"):a+="?.kl=Y",this._sendQueue=[];try{b?(this._requestedProtocol=b,this._delegate=new i(a,b)):this._delegate=new i(a),this._delegate.binaryType="arraybuffer"}catch(e){return void c(this)}l(this)},t.onerror=function(){},t.onmessage=function(){},t.onopen=function(){},t.onclose=function(){},t.close=function(b,c){b?r?a(this,b,c):this._delegate.close(b,c):this._delegate.close()},t.send=function(a){b(this,a)},t.setListener=function(a){this._listener=a},t.setIdleTimeout=function(a){this.lastMessageTimestamp=(new Date).getTime(),this.idleTimeout=a,n(this,a)},q}(),k=function(){var a=function(b){this.HOST=new a(0),this.USERINFO=new a(1),this.PORT=new a(2),this.PATH=new a(3),this.ordinal=b};return a}(),l=function(){var a=function(){};return a.getRealm=function(a){var b=a.authenticationParameters;if(null==b)return null;var c=/realm=(\"(.*)\")/i,d=c.exec(b);return null!=d&&d.length>=3?d[2]:null},a}(),m=function(){var b=function(b){this.weakKeys=b,this.elements=[],this.dictionary=new a},c=b.prototype;return c.getlength=function(){return this.elements.length},c.getItemAt=function(a){return this.dictionary[this.elements[a]]},c.get=function(a){var b=this.dictionary[a];return void 0==b&&(b=null),b},c.remove=function(a){for(var b=0;b<this.elements.length;b++){var c=this.weakKeys&&this.elements[b]==a,d=!this.weakKeys&&this.elements[b]===a;if(c||d){this.elements.remove(b),this.dictionary[this.elements[b]]=void 0;break}}},c.put=function(a,b){this.remove(a),this.elements.push(a),this.dictionary[a]=b},c.isEmpty=function(){return 0==this.length},c.containsKey=function(a){for(var b=0;b<this.elements.length;b++){var c=this.weakKeys&&this.elements[b]==a,d=!this.weakKeys&&this.elements[b]===a;if(c||d)return!0}return!1},c.keySet=function(){return this.elements},c.getvalues=function(){for(var a=[],b=0;b<this.elements.length;b++)a.push(this.dictionary[this.elements[b]]);return a},b}(),n=function(){var a=function(){this.name="",this.kind="",this.values=[],this.children=new m},b=a.prototype;return b.getWildcardChar=function(){return"*"},b.addChild=function(b,c){if(null==b||0==b.length)throw new ArgumentError("A node may not have a null name.");var d=a.createNode(b,this,c);return this.children.put(b,d),d},b.hasChild=function(a,b){return null!=this.getChild(a)&&b==this.getChild(a).kind},b.getChild=function(a){return this.children.get(a)},b.getDistanceFromRoot=function(){for(var a=0,b=this;!b.isRootNode();)a++,b=b.parent;return a},b.appendValues=function(){if(this.isRootNode())throw new ArgumentError("Cannot set a values on the root node.");if(null!=this.values)for(var a=0;a<arguments.length;a++){var b=arguments[a];this.values.push(b)}},b.removeValue=function(a){if(!this.isRootNode())for(var b=0;b<this.values.length;b++)this.values[b]==a&&this.values.splice(b,1)},b.getValues=function(){return this.values},b.hasValues=function(){return null!=this.values&&this.values.length>0},b.isRootNode=function(){return null==this.parent},b.hasChildren=function(){return null!=this.children&&this.children.getlength()>0},b.isWildcard=function(){return null!=this.name&&this.name==this.getWildcardChar()},b.hasWildcardChild=function(){return this.hasChildren()&&this.children.containsKey(this.getWildcardChar())},b.getFullyQualifiedName=function(){for(var a=new String,b=[],c=this;!c.isRootNode();)b.push(c.name),c=c.parent;b=b.reverse();for(var d=0;d<b.length;d++)a+=b[d],a+=".";return a.length>=1&&"."==a.charAt(a.length-1)&&(a=a.slice(0,a.length-1)),a.toString()},b.getChildrenAsList=function(){return this.children.getvalues()},b.findBestMatchingNode=function(a,b){for(var c=this.findAllMatchingNodes(a,b),d=null,e=0,f=0;f<c.length;f++){var g=c[f];g.getDistanceFromRoot()>e&&(e=g.getDistanceFromRoot(),d=g)}return d},b.findAllMatchingNodes=function(a,b){for(var c=[],d=this.getChildrenAsList(),e=0;e<d.length;e++){var f=d[e],g=f.matches(a,b);if(!(0>g))if(g>=a.length){do if(f.hasValues()&&c.push(f),f.hasWildcardChild()){var h=f.getChild(this.getWildcardChar());f=h.kind!=this.kind?null:h}else f=null;while(null!=f)}else for(var i=f.findAllMatchingNodes(a,g),j=0;j<i.length;j++)c.push(i[j])}return c},b.matches=function(a,b){if(0>b||b>=a.length)return-1;if(this.matchesToken(a[b]))return b+1;if(this.isWildcard()){if(this.kind!=a[b].kind)return-1;do b++;while(b<a.length&&this.kind==a[b].kind);return b}return-1},b.matchesToken=function(a){return this.name==a.name&&this.kind==a.kind},a.createNode=function(b,c,d){var e=new a;return e.name=b,e.parent=c,e.kind=d,e},a}(),o=function(){var a=function(a,b){this.kind=b,this.name=a};return a}();f.Oid=function(){var a=function(a){this.rep=a},b=a.prototype;return b.asArray=function(){return this.rep},b.asString=function(){for(var a="",b=0;b<this.rep.length;b++)a+=this.rep[b].toString(),a+=".";return a.length>0&&"."==a.charAt(a.length-1)&&(a=a.slice(0,a.length-1)),a},a.create=function(b){return new a(b.split("."))},a}();var p=function(){var a=function(){};return a.create=function(a,b,c){for(var d=a+":"+b,e=[],f=0;f<d.length;++f)e.push(d.charCodeAt(f));var g="Basic "+Base64.encode(e);return new s(g,c)},a}();!function(a){var b=function(a,b){this.username=a,this.password=b};return b.prototype.clear=function(){this.username=null,this.password=null},a.PasswordAuthentication=b,b}(Kaazing.Gateway);var q=Kaazing.Gateway.PasswordAuthentication;!function(a){var b=function(a,b){if(null==a)throw new Error("location is not defined.");if(null!=b){var c="Application ";0==b.indexOf(c)&&(b=b.substring(c.length)),this.location=a,this.authenticationParameters=null;var d=b.indexOf(" ");-1==d?this.authenticationScheme=b:(this.authenticationScheme=b.substring(0,d),b.length>d+1&&(this.authenticationParameters=b.substring(d+1)))}};return a.ChallengeRequest=b,b}(Kaazing.Gateway);var r=Kaazing.Gateway.ChallengeRequest;!function(a){a.ChallengeResponse=function(){var a=function(a,b){this.credentials=a,this.nextChallengeHandler=b},b=a.prototype;return b.clearCredentials=function(){null!=this.credentials&&(this.credentials=null)},a}()}(Kaazing.Gateway);var s=Kaazing.Gateway.ChallengeResponse;!function(a){var b=function(){this.loginHandler=void 0,this.loginHandlersByRealm={}},c=b.prototype;c.setRealmLoginHandler=function(a,b){if(null==a)throw new ArgumentError("null realm");if(null==b)throw new ArgumentError("null loginHandler");return this.loginHandlersByRealm[a]=b,this},c.canHandle=function(a){return null!=a&&"Basic"==a.authenticationScheme},c.handle=function(a,b){if(null!=a.location){var c=this.loginHandler,d=l.getRealm(a);null!=d&&null!=this.loginHandlersByRealm[d]&&(c=this.loginHandlersByRealm[d]);var e=this;if(null!=c)return void c(function(a){b(null!=a&&null!=a.username?p.create(a.username,a.password,e):null)})}b(null)},c.loginHandler=function(a){a(null)},a.BasicChallengeHandler=b}(Kaazing.Gateway);var t=Kaazing.Gateway.BasicChallengeHandler;f.DispatchChallengeHandler=function(){function a(a,b,c){for(var d=f(b),e=a,g=0;g<d.length;g++){var h=d[g];if(!e.hasChild(h.name,h.kind))return;e=e.getChild(h.name)}e.removeValue(c)}function b(a,b,c){for(var d=f(b),e=a,g=0;g<d.length;g++){var h=d[g];e=e.hasChild(h.name,h.kind)?e.getChild(h.name):e.addChild(h.name,h.kind)}e.appendValues(c)}function c(a,b){var c=new Array;if(null!=b){var d=e(a,b);if(null!=d)return d.values}return c}function d(a,b){var c=null,d=b.location;if(null!=d){var f=e(a,d);if(null!=f){var g=f.getValues();if(null!=g)for(var h=0;h<g.length;h++){var i=g[h];if(i.canHandle(b)){c=i;break}}}}return c}function e(a,b){var c=f(b),d=0;return a.findBestMatchingNode(c,d)}function f(a){var b=new Array;if(null==a||0==a.length)return b;var c=new RegExp("^(([^:/?#]+):(//))?([^/?#]*)?([^?#]*)(\\?([^#]*))?(#(.*))?"),d=c.exec(a);if(null==d)return b;var e=d[2]||"http",f=d[4],h=d[5],j=null,l=null,m=null,n=null;if(null==f)throw new ArgumentError("Hostname is required.");var p=f,q=p.indexOf("@");if(q>=0){l=p.substring(0,q),p=p.substring(q+1);var r=l.indexOf(":");r>=0&&(m=l.substring(0,r),n=l.substring(r+1))}var s=p.indexOf(":");s>=0&&(j=p.substring(s+1),p=p.substring(0,s));var t=p.split(/\./);t.reverse();for(var u=0;u<t.length;u++)b.push(new o(t[u],k.HOST));if(null!=j?b.push(new o(j,k.PORT)):g(e)>0&&b.push(new o(g(e).toString(),k.PORT)),null!=l&&(null!=m&&b.push(new o(m,k.USERINFO)),null!=n&&b.push(new o(n,k.USERINFO)),null==m&&null==n&&b.push(new o(l,k.USERINFO))),i(h)&&("/"==h.charAt(0)&&(h=h.substring(1)),i(h)))for(var v=h.split("/"),w=0;w<v.length;w++){var x=v[w];b.push(new o(x,k.PATH))}return b}function g(a){return null!=h[a.toLowerCase()]?h[a]:-1}function h(){http=80,ws=80,wss=443,https=443}function i(a){return null!=a&&a.length>0}var j=function(){this.rootNode=new n;var a="^(.*)://(.*)";this.SCHEME_URI_PATTERN=new RegExp(a)},l=j.prototype;return l.clear=function(){this.rootNode=new n},l.canHandle=function(a){return null!=d(this.rootNode,a)},l.handle=function(a,b){var c=d(this.rootNode,a);return null==c?null:c.handle(a,b)},l.register=function(a,c){if(null==a||0==a.length)throw new Error("Must specify a location to handle challenges upon.");if(null==c)throw new Error("Must specify a handler to handle challenges.");return b(this.rootNode,a,c),this},l.unregister=function(b,c){if(null==b||0==b.length)throw new Error("Must specify a location to un-register challenge handlers upon.");if(null==c)throw new Error("Must specify a handler to un-register.");return a(this.rootNode,b,c),this},j}();var u=f.DispatchChallengeHandler;!function(a){var b=function(){this.candidateChallengeHandlers=new Array},c=a.Oid,d=function(a){for(var b=new Array,d=0;d<a.length;d++)b.push(c.create(a[d]).asArray());var f=GssUtils.sizeOfSpnegoInitialContextTokenWithOids(null,b),g=e.ByteBuffer.allocate(f);return g.skip(f),GssUtils.encodeSpnegoInitialContextTokenWithOids(null,b,g),ByteArrayUtils.arrayToByteArray(Base64Util.encodeBuffer(g))},f=b.prototype;return f.register=function(a){if(null==a)throw new Error("handler is null");for(var b=0;b<this.candidateChallengeHandlers.length;b++)if(a===this.candidateChallengeHandlers[b])return this;return this.candidateChallengeHandlers.push(a),this},f.canHandle=function(a){return null!=a&&"Negotiate"==a.authenticationScheme&&null==a.authenticationParameters},f.handle=function(a,b){if(null==a)throw Error(new ArgumentError("challengeRequest is null"));for(var d=new m,e=0;e<this.candidateChallengeHandlers.length;e++){var f=this.candidateChallengeHandlers[e];if(f.canHandle(a))try{for(var g=f.getSupportedOids(),h=0;h<g.length;h++){var i=new c(g[h]).asString();d.containsKey(i)||d.put(i,f)}}catch(j){}}return d.isEmpty()?void b(null):void 0},b}(Kaazing.Gateway);var v=Kaazing.Gateway.NegotiateChallengeHandler;f.NegotiableChallengeHandler=function(){var a=function(){this.loginHandler=void 0};return a.prototype.getSupportedOids=function(){return new Array},a}();var w=f.NegotiableChallengeHandler,x=function(){var a=function(){var a="",b=""};return a.KAAZING_EXTENDED_HANDSHAKE="x-kaazing-handshake",a.HEADER_SEC_EXTENSIONS="X-WebSocket-Extensions",a.KAAZING_SEC_EXTENSION_IDLE_TIMEOUT="x-kaazing-idle-timeout",a.KAAZING_SEC_EXTENSION_PING_PONG="x-kaazing-ping-pong",a}();!function(a){a.WebSocketExtension=function(){var a=function(a){this.name=a,this.parameters={},this.enabled=!1,this.negotiated=!1},b=a.prototype;return b.getParameter=function(a){return this.parameters[a]},b.setParameter=function(a,b){this.parameters[a]=b},b.getParameters=function(){var a=[];for(var b in this.parameters)this.parameters.hasOwnProperty(b)&&a.push(b);return a},b.parse=function(a){var b=a.split(";");if(b[0]!=this.name)throw new Error("Error: name not match");this.parameters={};for(var c=1;c<b.length;c++){var d=b[c].indexOf("=");this.parameters[b[c].subString(0,d)]=b[c].substring(d+1)}},b.toString=function(){var a=[this.name];for(var b in this.parameters)this.parameters.hasOwnProperty(b)&&a.push(b.name+"="+this.parameters[b]);return a.join(";")},a}()}(Kaazing.Gateway);var y=Kaazing.Gateway.WebSocketExtension,z={};!function(){var a={8364:128,129:129,8218:130,402:131,8222:132,8230:133,8224:134,8225:135,710:136,8240:137,352:138,8249:139,338:140,141:141,381:142,143:143,144:144,8216:145,8217:146,8220:147,8221:148,8226:149,8211:150,8212:151,732:152,8482:153,353:154,8250:155,339:156,157:157,382:158,376:159},b={128:8364,129:129,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,141:141,142:381,143:143,144:144,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,157:157,158:382,159:376};z.toCharCode=function(a){if(128>a||a>159&&256>a)return a;var c=b[a];if("undefined"==typeof c)throw new Error("Windows1252.toCharCode could not find: "+a);return c},z.fromCharCode=function(b){if(256>b)return b;var c=a[b];if("undefined"==typeof c)throw new Error("Windows1252.fromCharCode could not find: "+b);return c};var c=String.fromCharCode(127),d=String.fromCharCode(0),e="\n",f=function(a){for(var b=[],c=0;c<a.length;c++){var d=z.fromCharCode(a.charCodeAt(c));if(127==d){if(c++,c==a.length){b.hasRemainder=!0;break}var e=z.fromCharCode(a.charCodeAt(c));switch(e){case 127:b.push(127);break;case 48:b.push(0);break;case 110:b.push(10);break;case 114:b.push(13);break;default:throw new Error("Escaping format error")}}else b.push(d)}return b},g=function(a){for(var b=[];a.remaining();){var f=a.getUnsigned(),g=String.fromCharCode(z.toCharCode(f));switch(g){case c:b.push(c),b.push(c);break;case d:b.push(c),b.push("0");break;case e:b.push(c),b.push("n");break;default:b.push(g)}}return b.join("")};z.toArray=function(a,b){if(b)return f(a);for(var c=[],d=0;d<a.length;d++)c.push(z.fromCharCode(a.charCodeAt(d)));return c},z.toByteString=function(a,b){if(b)return g(a);for(var c=[];a.remaining();){var d=a.getUnsigned();c.push(String.fromCharCode(z.toCharCode(d)))}return c.join("")}}(),function(){function a(b,c){return{_array:b,size:b.length,type:c||"",slice:function(b,c,d){var e=this._array.slice(b,c);return a(e,d)},toString:function(){return"MemoryBlob: "+b.toString()}}}function b(b){var c=Array.prototype.concat.apply([],b);return new a(c)}if("undefined"!=typeof Blob)try{var c=new Blob(["Blob"]);return}catch(d){}var e=function(a,c){var d=c||{};if(window.WebKitBlobBuilder){for(var e=new window.WebKitBlobBuilder,f=0;f<a.length;f++){var g=a[f];d.endings?e.append(g,d.endings):e.append(g)}var i;return i=d.type?e.getBlob(type):e.getBlob(),i.slice=i.webkitSlice||i.slice,i}if(window.MozBlobBuilder){for(var e=new window.MozBlobBuilder,f=0;f<a.length;f++){var g=a[f];d.endings?e.append(g,d.endings):e.append(g)}var i;return i=d.type?e.getBlob(type):e.getBlob(),i.slice=i.mozSlice||i.slice,i}for(var j=[],f=0;f<a.length;f++){var g=a[f];if("string"==typeof g){var k=h.fromString(g,d.endings);j.push(k)}else if(g.byteLength)for(var l=new Uint8Array(g),f=0;f<g.byteLength;f++)j.push(l[f]);else if(g.length)j.push(g);else{if(!g._array)throw new Error("invalid type in Blob constructor");j.push(g._array)}}var i=b(j);return i.type=d.type,i};window.Blob=e}();var A=function(){this._queue=[],this._count=0,this.completion};A.prototype.enqueue=function(a){var b=this,c={};c.cb=a,c.id=this._count++,this._queue.push(c);var d=function(){b.processQueue(c.id,a,arguments)};return d},A.prototype.processQueue=function(a,b,c){for(var d=0;d<this._queue.length;d++)if(this._queue[d].id==a){this._queue[d].args=c;break}for(;this._queue.length&&void 0!==this._queue[0].args;){var e=this._queue.shift();e.cb.apply(null,e.args)}};var B=function(){var a=function(a,b){this.label=a,this.value=b};return a}(),C=function(){function a(a){return"http"==a||"https"==a}var b=function(b){var c=new URI(b);if(!a(c.scheme))throw new Error("HttpURI - invalid scheme: "+b);this._uri=c},c=b.prototype;return c.getURI=function(){return this._uri},c.duplicate=function(a){try{return new b(a)}catch(c){throw c}return null},c.isSecure=function(){return"https"==this._uri.scheme},c.toString=function(){return this._uri.toString()},b.replaceScheme=function(a,c){var d=URI.replaceProtocol(a,c);return new b(d)},b}(),D=function(){function a(a){return"ws"==a||"wss"==a}function b(a){try{return new c(a)}catch(b){throw b}return null}var c=function(b){var d=new URI(b);if(!a(d.scheme))throw new Error("WSURI - invalid scheme: "+b);this._uri=d,void 0==d.port&&(this._uri=new URI(c.addDefaultPort(b)))},d=c.prototype;d.getAuthority=function(){return this._uri.authority},d.isSecure=function(){return"wss"==this._uri.scheme},d.getHttpEquivalentScheme=function(){return this.isSecure()?"https":"http"},d.toString=function(){return this._uri.toString()};var e=80,f=443;return c.setDefaultPort=function(a){if(0==a.port){if("ws"==a.scheme)a.port=e;else if("wss"==a.scheme)a.port=f;else if("http"==a.scheme)a.port=80;else{if("https"!=a.schemel)throw new Error("Unknown protocol: "+a.scheme);a.port=443}a.authority=a.host+":"+a.port}},c.addDefaultPort=function(a){var b=new URI(a);return void 0==b.port&&c.setDefaultPort(b),b.toString()},c.replaceScheme=function(a,b){var d=URI.replaceProtocol(a,b);return new c(d)},c}(),E=function(){function a(a){var b=a.indexOf("://");return b>0?a.substr(0,b):""}function b(a){return null!=d[a]}function c(a){try{return new e(a)}catch(b){throw b}return null}var d={};d.ws="ws",d.wss="wss",d["javascript:wse"]="ws",d["javascript:wse+ssl"]="wss",d["javascript:ws"]="ws",d["javascript:wss"]="wss",d["flash:wsr"]="ws",d["flash:wsr+ssl"]="wss",d["flash:wse"]="ws",d["flash:wse+ssl"]="wss";var e=function(c){var e=a(c);if(!b(e))throw new SyntaxError("WSCompositeURI - invalid composite scheme: "+a(c));this._uri=new URI(URI.replaceProtocol(c,d[e])),this._compositeScheme=e,this._location=c},f=e.prototype;return f.isSecure=function(){var a=this._uri.scheme;return"wss"==d[a]},f.getWSEquivalent=function(){try{var a=d[this._compositeScheme];return D.replaceScheme(this._location,a)}catch(b){throw b}return null},f.getPlatformPrefix=function(){return 0===this._compositeScheme.indexOf("javascript:")?"javascript":0===this._compositeScheme.indexOf("flash:")?"flash":""},f.toString=function(){return this._location},e}(),F=function(){var a=function(a,b,c){if(arguments.length<3){var d="ResumableTimer: Please specify the required parameters 'callback', 'delay', and 'updateDelayWhenPaused'.";throw Error(d)}if("undefined"==typeof a||null==a){var d="ResumableTimer: Please specify required parameter 'callback'.";throw Error(d)}if("function"!=typeof a){var d="ResumableTimer: Required parameter 'callback' must be a function.";throw Error(d)}if("undefined"==typeof b){var d="ResumableTimer: Please specify required parameter 'delay' of type integer.";throw Error(d)}if("number"!=typeof b||0>=b){var d="ResumableTimer: Required parameter 'delay' should be a positive integer.";throw Error(d)}if("undefined"==typeof c){var d="ResumableTimer: Please specify required boolean parameter 'updateDelayWhenPaused'.";throw Error(d)}if("boolean"!=typeof c){var d="ResumableTimer: Required parameter 'updateDelayWhenPaused' is a boolean.";throw Error(d)}this._delay=b,this._updateDelayWhenPaused=c,this._callback=a,this._timeoutId=-1,this._startTime=-1},b=a.prototype;return b.cancel=function(){-1!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=-1),this._delay=-1,this._callback=null},b.pause=function(){if(-1!=this._timeoutId){window.clearTimeout(this._timeoutId);var a=(new Date).getTime(),b=a-this._startTime;this._timeoutId=-1,this._updateDelayWhenPaused&&(this._delay=this._delay-b)}},b.resume=function(){if(-1==this._timeoutId){if(null==this._callback){var a="Timer cannot be resumed as it has been canceled.";throw new Error(a)}this.start()}},b.start=function(){if(this._delay<0)var a="Timer delay cannot be negative";this._timeoutId=window.setTimeout(this._callback,this._delay),this._startTime=(new Date).getTime()},a}(),G=function(){var a=function(){this._parent=null,this._challengeResponse=new f.ChallengeResponse(null,null)};return a.prototype.toString=function(){return"[Channel]"},a}(),H=function(){var a=function(a,b,c){G.apply(this,arguments),this._location=a,this._protocol=b,this._extensions=[],this._controlFrames={},this._controlFramesBinary={},this._escapeSequences={},this._handshakePayload="",this._isEscape=!1,this._bufferedAmount=0},b=a.prototype=new G;return b.getBufferedAmount=function(){return this._bufferedAmount},b.toString=function(){return"[WebSocketChannel "+_location+" "+_protocol!=null?_protocol:"-]"},a}(),I=function(){var a=function(){this._nextHandler,this._listener},b=a.prototype;return b.processConnect=function(a,b,c){this._nextHandler.processConnect(a,b,c)},b.processAuthorize=function(a,b){this._nextHandler.processAuthorize(a,b)
},b.processTextMessage=function(a,b){this._nextHandler.processTextMessage(a,b)},b.processBinaryMessage=function(a,b){this._nextHandler.processBinaryMessage(a,b)},b.processClose=function(a,b,c){this._nextHandler.processClose(a,b,c)},b.setIdleTimeout=function(a,b){this._nextHandler.setIdleTimeout(a,b)},b.setListener=function(a){this._listener=a},b.setNextHandler=function(a){this._nextHandler=a},a}(),J=function(a){this.connectionOpened=function(b,c){a._listener.connectionOpened(b,c)},this.textMessageReceived=function(b,c){a._listener.textMessageReceived(b,c)},this.binaryMessageReceived=function(b,c){a._listener.binaryMessageReceived(b,c)},this.connectionClosed=function(b,c,d,e){a._listener.connectionClosed(b,c,d,e)},this.connectionError=function(b,c){a._listener.connectionError(b,c)},this.connectionFailed=function(b){a._listener.connectionFailed(b)},this.authenticationRequested=function(b,c,d){a._listener.authenticationRequested(b,c,d)},this.redirected=function(b,c){a._listener.redirected(b,c)},this.onBufferedAmountChange=function(b,c){a._listener.onBufferedAmountChange(b,c)}},K=function(){var a=function(a,b){H.apply(this,arguments),this.requestHeaders=[],this.responseHeaders={},this.readyState=db.CONNECTING,this.authenticationReceived=!1,this.wasCleanClose=!1,this.closeCode=1006,this.closeReason="",this.preventFallback=!1};return a}(),L=function(){var a=function(){},b=a.prototype;return b.createChannel=function(a,b,c){var d=new K(a,b,c);return d},a}(),M=function(){var a=function(){},b=a.prototype;return b.createChannel=function(a,b){var c=new K(a,b);return c},a}(),N=function(){var a=function(a,b){this._location=a.getWSEquivalent(),this._protocol=b,this._webSocket,this._compositeScheme=a._compositeScheme,this._connectionStrategies=[],this._selectedChannel,this.readyState=0,this._closing=!1,this._negotiatedExtensions={},this._compositeScheme=a._compositeScheme},b=a.prototype=new H;return b.getReadyState=function(){return this.readyState},b.getWebSocket=function(){return this._webSocket},b.getCompositeScheme=function(){return this._compositeScheme},b.getNextStrategy=function(){return this._connectionStrategies.length<=0?null:this._connectionStrategies.shift()},b.getRedirectPolicy=function(){return this.getWebSocket().getRedirectPolicy()},a}(),O=function(){var a=function(){},b=function(a,b){for(var c=0,d=b;b+4>d;d++)c=(c<<8)+a.getAt(d);return c},c=function(a){if(a.byteLength>3){var b=new DataView(a);return b.getInt32(0)}return 0},d=function(a){for(var b=0,c=0;4>c;c++)b=(b<<8)+a.charCodeAt(c);return b},f=[9,0],h=[10,0],i={},j=function(a){if("undefined"==typeof i.escape){var b=[],c=4;do b[--c]=255&a,a>>=8;while(c);i.escape=String.fromCharCode.apply(null,b.concat(h))}return i.escape},k=function(a,b,c,d){if(x.KAAZING_SEC_EXTENSION_PING_PONG==b._controlFrames[d]&&c.charCodeAt(4)==f[0]){var e=j(d);a._nextHandler.processTextMessage(b,e)}},l=a.prototype=new I;return l.handleConnectionOpened=function(a,b){var c=a.responseHeaders;if(null!=c[x.HEADER_SEC_EXTENSIONS]){var d=c[x.HEADER_SEC_EXTENSIONS];if(null!=d&&d.length>0)for(var e=d.split(","),f=0;f<e.length;f++){var g=e[f].split(";"),h=g[0].replace(/^\s+|\s+$/g,""),i=new y(h);if(i.enabled=!0,i.negotiated=!0,g.length>1){var j=g[1].replace(/^\s+|\s+$/g,"");if(8==j.length)try{var k=parseInt(j,16);a._controlFrames[k]=h,i.escape=j}catch(l){LOG.finest(CLASS_NAME,"parse control frame bytes error")}}a.parent._negotiatedExtensions[h]=i}}this._listener.connectionOpened(a,b)},l.handleTextMessageReceived=function(a,b){if(a._isEscape)return a._isEscape=!1,void this._listener.textMessageReceived(a,b);if(null==b||b.length<4)return void this._listener.textMessageReceived(a,b);var c=d(b);if(null!=a._controlFrames[c]){if(4==b.length)return void(a._isEscape=!0);k(this,a,b,c)}else this._listener.textMessageReceived(a,b)},l.handleMessageReceived=function(a,d){if(a._isEscape)return a._isEscape=!1,void this._listener.binaryMessageReceived(a,d);if("undefined"!=typeof d.byteLength){var f=c(d);if(null!=a._controlFramesBinary[f]){if(4==d.byteLength)return void(a._isEscape=!0);k(this,a,String.fromCharCode.apply(null,new Uint8Array(d,0)),f)}else this._listener.binaryMessageReceived(a,d)}else if(d.constructor==e.ByteBuffer){if(null==d||d.limit<4)return void this._listener.binaryMessageReceived(a,d);var f=b(d,d.position);if(null!=a._controlFramesBinary[f]){if(4==d.limit)return void(a._isEscape=!0);k(this,a,d.getString(g.UTF8),f)}else this._listener.binaryMessageReceived(a,d)}},l.processTextMessage=function(a,b){if(b.length>=4){var c=d(b);if(null!=a._escapeSequences[c]){var e=b.slice(0,4);this._nextHandler.processTextMessage(a,e)}}this._nextHandler.processTextMessage(a,b)},l.setNextHandler=function(a){var b=this;this._nextHandler=a;var c=new J(this);c.connectionOpened=function(a,c){b.handleConnectionOpened(a,c)},c.textMessageReceived=function(a,c){b.handleTextMessageReceived(a,c)},c.binaryMessageReceived=function(a,c){b.handleMessageReceived(a,c)},a.setListener(c)},l.setListener=function(a){this._listener=a},a}(),P=function(a){var b=function(a){this.channel=a},c=function(a){var b=a.parent;return b?b.readyState>=2:!1},d=b.prototype;return d.connect=function(a){if(!c(this.channel)){var b=this,d=new XMLHttpRequest0;d.withCredentials=!0,d.open("GET",a+"&.krn="+Math.random(),!0),null!=b.channel._challengeResponse&&null!=b.channel._challengeResponse.credentials&&(d.setRequestHeader("Authorization",b.channel._challengeResponse.credentials),this.clearAuthenticationData(b.channel)),d.onreadystatechange=function(){switch(d.readyState){case 2:403==d.status&&d.abort();break;case 4:if(401==d.status)return void b.handle401(b.channel,a,d.getResponseHeader("WWW-Authenticate"))}},d.send(null)}},d.clearAuthenticationData=function(a){null!=a._challengeResponse&&a._challengeResponse.clearCredentials()},d.handle401=function(b,d,e){if(!c(b)){var f=this,g=d;g.indexOf("/;a/")>0?g=g.substring(0,g.indexOf("/;a/")):g.indexOf("/;ae/")>0?g=g.substring(0,g.indexOf("/;ae/")):g.indexOf("/;ar/")>0&&(g=g.substring(0,g.indexOf("/;ar/")));var h=new a.ChallengeRequest(g,e),i;i=null!=this.channel._challengeResponse.nextChallengeHandler?this.channel._challengeResponse.nextChallengeHandler:b.challengeHandler,null!=i&&i.canHandle(h)&&i.handle(h,function(a){try{null!=a&&null!=a.credentials&&(f.channel._challengeResponse=a,f.connect(d))}catch(b){}})}},b}(Kaazing.Gateway),Q=function(){var a=function(){},b=a.prototype=new I;b.processConnect=function(a,b,d){if(a.readyState==db.CLOSED)throw new Error("WebSocket is already closed");if(null==a._delegate){var e=new j;e.parent=a,a._delegate=e,c(e,this)}a._delegate.connect(b.toString(),d)},b.processTextMessage=function(a,b){if(a._delegate.readyState()!=db.OPEN)throw new Error("WebSocket is already closed");a._delegate.send(b)},b.processBinaryMessage=function(a,b){if(a._delegate.readyState()!=db.OPEN)throw new Error("WebSocket is already closed");a._delegate.send(b)},b.processClose=function(a,b,c){try{a._delegate.close(b,c)}catch(d){}},b.setIdleTimeout=function(a,b){try{a._delegate.setIdleTimeout(b)}catch(c){}};var c=function(a,b){var c=new J(b);a.setListener(c)};return a}(),R=function(a){var b=function(){},c=function(a,b,c){b._redirecting=!0,b._redirectUri=c,a._nextHandler.processClose(b)},d=b.prototype=new I;return d.processConnect=function(a,b,c){a._balanced=0,this._nextHandler.processConnect(a,b,c)},d.handleConnectionClosed=function(b,c,d,e){if(1==b._redirecting){b._redirecting=!1;var f=b._redirectUri,g=b._location,h=b.parent,i=h.getRedirectPolicy();if(i instanceof a.HttpRedirectPolicy&&!i.isRedirectionAllowed(g.toString(),f.toString())){b.preventFallback=!0;var j=i.toString()+": Cannot redirect from "+g.toString()+" to "+f.toString();return void this._listener.connectionClosed(b,!1,1006,j)}b._redirected=!0,b.handshakePayload="";for(var k=[x.KAAZING_EXTENDED_HANDSHAKE],l=0;l<b._protocol.length;l++)k.push(b._protocol[l]);this.processConnect(b,b._redirectUri,k)}else this._listener.connectionClosed(b,c,d,e)},d.handleMessageReceived=function(a,b){if(a._balanced>1)return void this._listener.binaryMessageReceived(a,b);var d=decodeArrayBuffer(b);if(61695!=d.charCodeAt(0))this._listener.binaryMessageReceived(a,b);else if(d.match("N$"))a._balanced++,1==a._balanced?this._listener.connectionOpened(a,x.KAAZING_EXTENDED_HANDSHAKE):this._listener.connectionOpened(a,a._acceptedProtocol||"");else if(1==d.indexOf("R")){var e=new D(d.substring(2));c(this,a,e)}},d.setNextHandler=function(a){this._nextHandler=a;var b=new J(this),d=this;b.connectionOpened=function(a,b){x.KAAZING_EXTENDED_HANDSHAKE!=b&&(a._balanced=2,d._listener.connectionOpened(a,b))},b.textMessageReceived=function(a,b){if(a._balanced>1)return void d._listener.textMessageReceived(a,b);if(61695!=b.charCodeAt(0))d._listener.textMessageReceived(a,b);else if(b.match("N$"))a._balanced++,1==a._balanced?d._listener.connectionOpened(a,x.KAAZING_EXTENDED_HANDSHAKE):d._listener.connectionOpened(a,"");else if(1==b.indexOf("R")){var e=new D(b.substring(2));c(d,a,e)}},b.binaryMessageReceived=function(a,b){d.handleMessageReceived(a,b)},b.connectionClosed=function(a,b,c,e){d.handleConnectionClosed(a,b,c,e)},a.setListener(b)},d.setListener=function(a){this._listener=a},b}(Kaazing.Gateway),S=function(){var a="Sec-WebSocket-Protocol",b="Sec-WebSocket-Extensions",c="Authorization",d="WWW-Authenticate",e="Set-Cookie",f="GET",g="HTTP/1.1",h=":",i=" ",j="\r\n",k=function(){},l=function(a,b){var c=new XMLHttpRequest0,d=a._location.getHttpEquivalentScheme()+"://"+a._location.getAuthority()+(a._location._uri.path||"");d=d.replace(/[\/]?$/,"/;api/set-cookies"),c.open("POST",d,!0),c.setRequestHeader("Content-Type","text/plain; charset=utf-8"),c.send(b)},m=function(d,e,f){var g=[],h=[];g.push("WebSocket-Protocol"),h.push(""),g.push(a),h.push(e._protocol.join(","));var i=[x.KAAZING_SEC_EXTENSION_IDLE_TIMEOUT,x.KAAZING_SEC_EXTENSION_PING_PONG],j=e._extensions;j.length>0&&i.push(j),g.push(b),h.push(i.join(",")),g.push(c),h.push(f);var k=n(e._location,g,h);d._nextHandler.processTextMessage(e,k)},n=function(a,b,c){var d=[];d.push(f),d.push(i);var e=[];void 0!=a._uri.path&&e.push(a._uri.path),void 0!=a._uri.query&&(e.push("?"),e.push(a._uri.query)),d.push(e.join("")),d.push(i),d.push(g),d.push(j);for(var k=0;k<b.length;k++){var l=b[k],m=c[k];null!=l&&null!=m&&(d.push(l),d.push(h),d.push(i),d.push(m),d.push(j))}d.push(j);var n=d.join("");return n},o=function(c,f,g){if(g.length>0)return void(f.handshakePayload+=g);var h=f.handshakePayload.split("\n");f.handshakePayload="";for(var i="",j=h.length-1;j>=0;j--)if(0==h[j].indexOf("HTTP/1.1")){var k=h[j].split(" ");i=k[1];break}if("101"!=i)if("401"==i){f.handshakestatus=2;for(var m="",j=0;j<h.length;j++)if(0==h[j].indexOf(d)){m=h[j].substring(d.length+2);break}c._listener.authenticationRequested(f,f._location.toString(),m)}else c._listener.connectionFailed(f);else{for(var n=[],o="",j=0;j<h.length;j++){var p=h[j];null!=p&&0==p.indexOf(b)?n.push(p.substring(b.length+2)):null!=p&&0==p.indexOf(a)?o=p.substring(a.length+2):null!=p&&0==p.indexOf(e)&&l(f,p.substring(e.length+2))}if(f._acceptedProtocol=o,n.length>0){for(var q=[],r=n.join(", ").split(", "),s=0;s<r.length;s++){var t=r[s].split(";"),u=t[0].replace(/^\s+|\s+$/g,""),v=new y(u);if(x.KAAZING_SEC_EXTENSION_IDLE_TIMEOUT!==u){if(x.KAAZING_SEC_EXTENSION_PING_PONG===u)try{var w=t[1].replace(/^\s+|\s+$/g,""),z=parseInt(w,16);f._controlFrames[z]=u,f._escapeSequences[z]=u;continue}catch(A){throw new Error("failed to parse escape key for x-kaazing-ping-pong extension")}else if(t.length>1){var w=t[1].replace(/^\s+|\s+$/g,"");if(8==w.length)try{var z=parseInt(w,16);f._controlFrames[z]=u,v.escape=w}catch(A){}}v.enabled=!0,v.negotiated=!0,q.push(r[s])}else{var B=t[1].match(/\d+/)[0];B>0&&c._nextHandler.setIdleTimeout(f,B)}}q.length>0&&(f.parent._negotiatedExtensions[u]=q.join(","))}}},p=function(a,b){try{b.handshakestatus=3,a._nextHandler.processClose(b)}finally{a._listener.connectionFailed(b)}},q=k.prototype=new I;return q.processConnect=function(a,b,c){a.handshakePayload="";for(var d=[x.KAAZING_EXTENDED_HANDSHAKE],e=0;e<c.length;e++)d.push(c[e]);if(this._nextHandler.processConnect(a,b,d),"undefined"==typeof a.parent.connectTimer||null==a.parent.connectTimer){a.handshakestatus=0;var f=this;setTimeout(function(){0==a.handshakestatus&&p(f,a)},5e3)}},q.processAuthorize=function(a,b){m(this,a,b)},q.handleConnectionOpened=function(a,b){if(x.KAAZING_EXTENDED_HANDSHAKE==b){if(m(this,a,null),a.handshakestatus=1,"undefined"==typeof a.parent.connectTimer||null==a.parent.connectTimer){var c=this;setTimeout(function(){a.handshakestatus<2&&p(c,a)},5e3)}}else a.handshakestatus=2,this._listener.connectionOpened(a,b)},q.handleMessageReceived=function(a,b){a.readyState==db.OPEN?(a._isEscape=!1,this._listener.textMessageReceived(a,b)):o(this,a,b)},q.handleBinaryMessageReceived=function(a,b){a.readyState==db.OPEN?(a._isEscape=!1,this._listener.binaryMessageReceived(a,b)):o(this,a,String.fromCharCode.apply(null,new Uint8Array(b)))},q.setNextHandler=function(a){this._nextHandler=a;var b=this,c=new J(this);c.connectionOpened=function(a,c){b.handleConnectionOpened(a,c)},c.textMessageReceived=function(a,c){b.handleMessageReceived(a,c)},c.binaryMessageReceived=function(a,c){b.handleBinaryMessageReceived(a,c)},c.connectionClosed=function(a,c,d,e){a.handshakestatus<3&&(a.handshakestatus=3),b._listener.connectionClosed(a,c,d,e)},c.connectionFailed=function(a){a.handshakestatus<3&&(a.handshakestatus=3),b._listener.connectionFailed(a)},a.setListener(c)},q.setListener=function(a){this._listener=a},k}(),T=function(a){var b=function(){},c=b.prototype=new I;return c.handleClearAuthenticationData=function(a){null!=a._challengeResponse&&a._challengeResponse.clearCredentials()},c.handleRemoveAuthenticationData=function(b){this.handleClearAuthenticationData(b),b._challengeResponse=new a.ChallengeResponse(null,null)},c.doError=function(a){this._nextHandler.processClose(a),this.handleClearAuthenticationData(a),this._listener.connectionFailed(a)},c.handle401=function(b,c,d){var e=this,f=b._location,g=null;"undefined"!=typeof b.parent.connectTimer&&(g=b.parent.connectTimer,null!=g&&g.pause()),null!=b.redirectUri&&(f=b._redirectUri);var h=new a.ChallengeRequest(f.toString(),d),i;i=null!=b._challengeResponse.nextChallengeHandler?b._challengeResponse.nextChallengeHandler:b.parent.challengeHandler,null!=i&&i.canHandle(h)?i.handle(h,function(a){try{null==a||null==a.credentials?e.doError(b):(null!=g&&g.resume(),b._challengeResponse=a,e._nextHandler.processAuthorize(b,a.credentials))}catch(c){e.doError(b)}}):this.doError(b)},c.handleAuthenticate=function(a,b,c){a.authenticationReceived=!0,this.handle401(a,b,c)},c.setNextHandler=function(a){this._nextHandler=a;var b=this,c=new J(this);c.authenticationRequested=function(a,c,d){b.handleAuthenticate(a,c,d)},a.setListener(c)},c.setListener=function(a){this._listener=a},b}(Kaazing.Gateway),U=function(){var a=function(){},b=a.prototype=new I;return b.processConnect=function(a,b,c){this._nextHandler.processConnect(a,b,c)},b.processBinaryMessage=function(a,b){if(b.constructor==e.ByteBuffer){var c=b.array.slice(b.position,b.limit);this._nextHandler.processTextMessage(a,g.UTF8.encodeByteArray(c))}else if(b.byteLength)this._nextHandler.processTextMessage(a,g.UTF8.encodeArrayBuffer(b));else{if(!b.size)throw new Error("Invalid type for send");var d=this,f=function(b){d._nextHandler.processBinaryMessage(a,g.UTF8.encodeByteArray(b))};h.asNumberArray(f,b)}},b.setNextHandler=function(a){this._nextHandler=a;var b=this,c=new J(this);c.textMessageReceived=function(a,c){b._listener.binaryMessageReceived(a,e.ByteBuffer.wrap(g.UTF8.toByteArray(c)))},c.binaryMessageReceived=function(a,b){throw new Error("draft76 won't receive binary frame")},a.setListener(c)},b.setListener=function(a){this._listener=a},a}(),V=function(){var a=function(){var a=new T;return a},b=function(){var a=new S;return a},c=function(){var a=new O;return a},d=function(){var a=new R;return a},e=function(){var a=new Q;return a},f=function(){var a=new U;return a},g="safari"==browser&&"undefined"!=typeof window.Webscoket&&"undefined"==typeof window.WebSocket.CLOSING,h=a(),i=b(),j=c(),k=d(),l=e(),m=f(),n=function(){g?(this.setNextHandler(m),m.setNextHandler(h)):this.setNextHandler(h),h.setNextHandler(i),i.setNextHandler(j),j.setNextHandler(k),k.setNextHandler(l)},o=function(a,b){},p=n.prototype=new I;return p.setNextHandler=function(a){this._nextHandler=a;var b=new J(this);a.setListener(b)},p.setListener=function(a){this._listener=a},n}(),W=function(){function a(c,e){null!==c.reconnectTimer&&(c.reconnectTimer=null),p(c);var f=new URI(c.location),g=[];switch(browser){case"ie":g.push(".kns=1"),g.push(".kf=200&.kp=2048");break;case"safari":g.push(".kp=256");break;case"firefox":g.push(".kp=1025");break;case"android":g.push(".kp=4096"),g.push(".kbp=4096")}("android"==browser||browser.ios)&&g.push(".kkt=20"),g.push(".kc=text/plain;charset=windows-1252"),g.push(".kb=4096"),g.push(".kid="+String(Math.random()).substring(2)),g.length>0&&(void 0===f.query?f.query=g.join("&"):f.query+="&"+g.join("&"));var h=new XMLHttpRequest0;h.id=r++,h.position=0,h.opened=!1,h.reconnect=!1,h.requestClosing=!1,h.onreadystatechange=function(){if(3==h.readyState&&null==c.idleTimer){var a=h.getResponseHeader("X-Idle-Timeout");if(a){var b=parseInt(a);b>0&&(b=1e3*b,c.idleTimeout=b,c.lastMessageTimestamp=(new Date).getTime(),n(c,b))}}},h.onprogress=function(){h==c.activeXhr&&2!=c.readyState&&d(c)},h.onload=function(){if(h==c.activeXhr&&2!=c.readyState)if(d(c),h.onerror=function(){},h.ontimeout=function(){},h.onreadystatechange=function(){},h.reconnect)if(h.requestClosing)k(c);else if(c.activeXhr==c.mostRecentXhr)a(c),c.activeXhr=c.mostRecentXhr,b(c,c.activeXhr);else{var e=c.mostRecentXhr;switch(c.activeXhr=e,e.readyState){case 1:case 2:b(c,e);break;case 3:d(c);break;case 4:c.activeXhr.onload()}}else l(c)},h.ontimeout=function(){l(c)},h.onerror=function(){l(c)},h.open("GET",f.toString(),!0),h.send(""),c.mostRecentXhr=h}function b(b,c){-1==b.location.indexOf(".ki=p")&&setTimeout(function(){c&&c.readyState<3&&b.readyState<2&&(b.location+=-1==b.location.indexOf("?")?"?.ki=p":"&.ki=p",a(b,!1))},C)}function c(a){null!==a.reconnectTimer&&(clearTimeout(a.reconnectTimer),a.reconnectTimer=null),p(a),null!==a.mostRecentXhr&&(a.mostRecentXhr.onprogress=function(){},a.mostRecentXhr.onload=function(){},a.mostRecentXhr.onerror=function(){},a.mostRecentXhr.abort()),a.activeXhr!=a.mostRecentXhr&&null!==a.activeXhr&&(a.activeXhr.onprogress=function(){},a.activeXhr.onload=function(){},a.activeXhr.onerror=function(){},a.activeXhr.abort()),a.lineQueue=[],a.lastEventId=null,a.location=null,a.readyState=2}function d(b){b.lastMessageTimestamp=(new Date).getTime();var c=b.activeXhr,d=c.responseText;d.length>=q&&b.activeXhr==b.mostRecentXhr&&a(b,!1);var k=d.slice(c.position);c.position=d.length;var l=b.buf,m=z.toArray(k,b.requiresEscaping);m.hasRemainder&&c.position--,l.position=l.limit,l.putBytes(m),l.position=0,l.mark();a:for(;;){if(!l.hasRemaining())break;var n=l.getUnsigned();switch(128&n){case u:var o=l.indexOf(v);if(-1==o)break a;var p=l.array.slice(l.position,o),r=new e.ByteBuffer(p),s=o-l.position;l.skip(s+1),l.mark(),n==w?f(b,r):i(b,r.getString(g.UTF8));break;case x:case y:for(var t=0,A=!1;l.hasRemaining();){var C=l.getUnsigned();if(t<<=7,t|=127&C,128!=(128&C)){A=!0;break}}if(!A)break a;if(l.remaining()<t)break a;var D=l.array.slice(l.position,l.position+t),E=new e.ByteBuffer(D);l.skip(t),l.mark(),n==x?h(b,E):n==B?j(b):i(b,E.getString(g.UTF8));break;default:throw new Error("Emulation protocol error. Unknown frame type: "+n)}}l.reset(),l.compact()}function f(a,b){for(;b.remaining();){var c=String.fromCharCode(b.getUnsigned());switch(c){case"0":break;case"1":a.activeXhr.reconnect=!0;break;case"2":a.activeXhr.requestClosing=!0;break;default:throw new Error("Protocol decode error. Unknown command: "+c)}}}function h(a,b){var c=document.createEvent("Events");c.initEvent("message",!0,!0),c.lastEventId=a.lastEventId,c.data=b,c.decoder=decodeByteString,c.origin=a.origin,null!==c.source&&(c.source=null),"function"==typeof a.onmessage&&a.onmessage(c)}function i(a,b){var c=document.createEvent("Events");c.initEvent("message",!0,!0),c.lastEventId=a.lastEventId,c.text=b,c.origin=a.origin,null!==c.source&&(c.source=null),"function"==typeof a.onmessage&&a.onmessage(c)}function j(a){"function"==typeof a.onping&&a.onping()}function k(a){l(a)}function l(a){2!=a.readyState&&(a.disconnect(),m(a))}function m(a){var b=document.createEvent("Events");b.initEvent("error",!0,!0),"function"==typeof a.onerror&&a.onerror(b)}function n(a,b){p(a),a.idleTimer=setTimeout(function(){o(a)},b)}function o(a){var b=(new Date).getTime(),c=b-a.lastMessageTimestamp,d=a.idleTimeout;c>d?l(a):n(a,d-c)}function p(a){null!=a.idleTimer&&(clearTimeout(a.idleTimer),a.IdleTimer=null)}var q=524288,r=1,s=function(c){this.retry=3e3,c.indexOf("/;e/dtem/")>0&&(this.requiresEscaping=!0);var d=new URI(c),f={http:80,https:443};void 0==d.port&&(d.port=f[d.scheme],d.authority=d.host+":"+d.port),this.origin=d.scheme+"://"+d.authority,this.location=c,this.activeXhr=null,this.reconnectTimer=null,this.idleTimer=null,this.idleTimeout=null,this.lastMessageTimestamp=null,this.buf=new e.ByteBuffer;var g=this;setTimeout(function(){a(g,!0),g.activeXhr=g.mostRecentXhr,b(g,g.mostRecentXhr)},0)},t=s.prototype,u=0,v=255,w=1,x=128,y=129,A=127,B=137,C=3e3;return t.readyState=0,t.disconnect=function(){2!==this.readyState&&c(this)},s}(),X=function(){function a(b){if(1==b.readyState){b.idleTimer&&clearTimeout(b.idleTimer);var d=new XMLHttpRequest0;d.onreadystatechange=function(){if(4==d.readyState)switch(d.status){case 200:setTimeout(function(){c(b)},0)}},d.onload=function(){a(b)},d.open("POST",b._upstream+"&.krn="+Math.random(),!0),b.upstreamXHR=d,b.idleTimer=setTimeout(function(){null!=b.upstreamXHR&&b.upstreamXHR.abort(),a(b)},3e4)}}function b(a,b){a.bufferedAmount+=b.remaining(),a._sendQueue.push(b),v(a),a._writeSuspended||c(a)}function c(a){var b=a._sendQueue,d=b.length;if(a._writeSuspended=d>0,d>0)if(a.useXDR){for(var f=new e.ByteBuffer;b.length;)f.putBuffer(b.shift());f.putBytes(p),f.flip(),a.upstreamXHR.setRequestHeader("Content-Type","text/plain; charset=utf-8"),a.upstreamXHR.send(encodeByteString(f,a.requiresEscaping))}else{var g=new XMLHttpRequest0;g.open("POST",a._upstream+"&.krn="+Math.random(),!0),g.onreadystatechange=function(){if(4==g.readyState)switch(g.status){case 200:setTimeout(function(){c(a)},0);break;default:u(a)}};for(var f=new e.ByteBuffer;b.length;)f.putBuffer(b.shift());f.putBytes(p),f.flip(),"firefox"==browser?g.sendAsBinary?(g.setRequestHeader("Content-Type","application/octet-stream"),g.sendAsBinary(encodeByteString(f))):g.send(encodeByteString(f)):(g.setRequestHeader("Content-Type","text/plain; charset=utf-8"),g.send(encodeByteString(f,a.requiresEscaping)))}a.bufferedAmount=0,v(a)}function d(a){a.readyState<2&&(a.readyState=2,a.idleTimer&&clearTimeout(a.idleTimer),null!=a.upstreamXHR&&a.upstreamXHR.abort(),null!=a.onerror&&a._listener.connectionFailed(a.parent))}var f=function(){this.parent,this._listener,this.closeCode=1005,this.closeReason=""},i=f.prototype;i.connect=function(a,b){this.URL=a.replace("ws","http"),this.protocol=b,this._prepareQueue=new A,this._sendQueue=[],s(this)},i.readyState=0,i.bufferedAmount=0,i.URL="",i.onopen=function(){},i.onerror=function(){},i.onmessage=function(a){},i.onclose=function(){};var j=128,k=129,l=0,m=255,n=1,o=138,p=[n,48,49,m],q=[n,48,50,m],r=function(a,b){var c=0,d=0;do d<<=8,d|=127&b,b>>=7,c++;while(b>0);do{var e=255&d;d>>=8,1!=c&&(e|=128),a.put(e)}while(--c>0)};i.send=function(a){var c=this;switch(this.readyState){case 0:throw new Error("INVALID_STATE_ERR");case 1:if(null===a)throw new Error("data is null");var d=new e.ByteBuffer;if("string"==typeof a){var f=new e.ByteBuffer;f.putString(a,g.UTF8),d.put(k),r(d,f.position),d.putBytes(f.array)}else if(a.constructor==e.ByteBuffer)d.put(j),r(d,a.remaining()),d.putBuffer(a);else{if(!a.byteLength){if(a.size){var i=this._prepareQueue.enqueue(function(a){var d=new e.ByteBuffer;d.put(j),r(d,a.length),d.putBytes(a),d.flip(),b(c,d)});return h.asNumberArray(i,a),!0}throw new Error("Invalid type for send")}d.put(j),r(d,a.byteLength),d.putByteArray(a)}return d.flip(),this._prepareQueue.enqueue(function(a){b(c,d)})(),!0;case 2:return!1;default:throw new Error("INVALID_STATE_ERR")}},i.close=function(a,c){switch(this.readyState){case 0:u(this);break;case 1:null!=a&&0!=a&&(this.closeCode=a,this.closeReason=c),b(this,new e.ByteBuffer(q))}},i.setListener=function(a){this._listener=a};var s=function(a){var b=new URI(a.URL);switch(b.scheme=b.scheme.replace("ws","http"),locationURI=new URI("ie"==browser?document.URL:location.href),"ie"==browser&&"undefined"!=typeof XDomainRequest&&b.scheme===locationURI.scheme&&(a.useXDR=!0),browser){case"opera":a.requiresEscaping=!0;break;case"ie":a.requiresEscaping=a.useXDR?"undefined"==typeof Object.defineProperties&&navigator.userAgent.indexOf("MSIE 8")>0?!0:!1:!0;break;default:a.requiresEscaping=!1}var c=a.requiresEscaping?"/;e/ctem":"/;e/ctm";b.path=b.path.replace(/[\/]?$/,c);var e=b.toString(),f=e.indexOf("?");e+=-1==f?"?":"&",e+=".kn="+String(Math.random()).substring(2);var g=new XMLHttpRequest0,h=!1;if(g.withCredentials=!0,g.open("GET",e,!0),g.setRequestHeader("Content-Type","text/plain; charset=utf-8"),g.setRequestHeader("X-WebSocket-Version","wseb-1.0"),g.setRequestHeader("X-Accept-Commands","ping"),a.protocol.length){var i=a.protocol.join(",");g.setRequestHeader("X-WebSocket-Protocol",i)}for(var j=0;j<a.parent.requestHeaders.length;j++){var k=a.parent.requestHeaders[j];g.setRequestHeader(k.label,k.value)}g.onredirectallowed=function(b,c){var e=a.parent.parent,f=e.getRedirectPolicy();return"undefined"==typeof f||null==f||f.isRedirectionAllowed(b,c)?!0:(g.statusText=f.toString()+": Cannot redirect from "+b+" to "+c,a.closeCode=1006,a.closeReason=g.statusText,a.parent.closeCode=a.closeCode,a.parent.closeReason=a.closeReason,a.parent.preventFallback=!0,d(a),!1)},g.onreadystatechange=function(){switch(g.readyState){case 2:if(403==g.status)d(a);else{var b=a.parent.parent._webSocket.connectTimeout;0==b&&(b=5e3),timer=setTimeout(function(){h||d(a)},b)}break;case 4:if(h=!0,401==g.status)return void a._listener.authenticationRequested(a.parent,g._location,g.getResponseHeader("WWW-Authenticate"));if(a.readyState<1)if(201==g.status){var c=g.responseText.split("\n"),e=c[0],f=c[1],i=new URI(g.xhr._location),j=new URI(e),k=new URI(f);if(i.host.toLowerCase()!=j.host.toLowerCase())throw new Error("Hostname in original URI does not match with the hostname in the upstream URI.");if(i.host.toLowerCase()!=k.host.toLowerCase())throw new Error("Hostname in original URI does not match with the hostname in the downstream URI.");a._upstream=i.scheme+"://"+i.authority+j.path,a._downstream=new W(f);var l=f.substring(0,f.indexOf("/;e/"));l!=a.parent._location.toString().replace("ws","http")&&(a.parent._redirectUri=l),y(a,a._downstream),a.parent.responseHeaders=g.getAllResponseHeaders(),t(a)}else d(a)}},g.send(null)},t=function(b){b.readyState=1;var c=b.parent;c._acceptedProtocol=c.responseHeaders["X-WebSocket-Protocol"]||"",b.useXDR&&(this.upstreamXHR=null,a(b)),b._listener.connectionOpened(b.parent,c._acceptedProtocol)},u=function(a,b,c,d){switch(a.readyState){case 2:break;case 0:case 1:a.readyState=db.CLOSED,a.idleTimer&&clearTimeout(a.idleTimer),null!=a.upstreamXHR&&a.upstreamXHR.abort(),"undefined"==typeof b?a._listener.connectionClosed(a.parent,!0,1005,""):a._listener.connectionClosed(a.parent,b,c,d)}},v=function(a){},w=function(a,b){b.text?a._listener.textMessageReceived(a.parent,b.text):b.data&&a._listener.binaryMessageReceived(a.parent,b.data)},x=function(a){var c=e.ByteBuffer.allocate(2);c.put(o),c.put(0),c.flip(),b(a,c)},y=function(a,b){b.onmessage=function(b){switch(b.type){case"message":1==a.readyState&&w(a,b)}},b.onping=function(){1==a.readyState&&x(a)},b.onerror=function(){try{b.disconnect()}finally{u(a,!0,a.closeCode,a.closeReason)}},b.onclose=function(c){try{b.disconnect()}finally{u(a,!0,this.closeCode,this.closeReason)}}};return f}(),Y=function(){var a=function(){},b=a.prototype=new I;b.processConnect=function(a,b,d){if(a.readyState==db.CLOSED)throw new Error("WebSocket is already closed");var e=window.MockWseTransport?new MockWseTransport:new X;e.parent=a,a._delegate=e,c(e,this),e.connect(b.toString(),d)},b.processTextMessage=function(a,b){if(a.readyState!=db.OPEN)throw new Error("WebSocket is already closed");a._delegate.send(b)},b.processBinaryMessage=function(a,b){if(a.readyState!=db.OPEN)throw new Error("WebSocket is already closed");a._delegate.send(b)},b.processClose=function(a,b,c){try{a._delegate.close(b,c)}catch(d){listener.connectionClosed(a)}};var c=function(a,b){var c=new J(b);a.setListener(c)};return a}(),Z=function(a){var b=function(){},c=b.prototype=new I;return c.handleClearAuthenticationData=function(a){null!=a._challengeResponse&&a._challengeResponse.clearCredentials()},c.handleRemoveAuthenticationData=function(b){this.handleClearAuthenticationData(b),b._challengeResponse=new a.ChallengeResponse(null,null)},c.handle401=function(b,c,d){var e=this,f=null;"undefined"!=typeof b.parent.connectTimer&&(f=b.parent.connectTimer,null!=f&&f.pause());var g=c;g.indexOf("/;e/")>0&&(g=g.substring(0,g.indexOf("/;e/")));var h=new D(g.replace("http","ws")),i=new a.ChallengeRequest(g,d),j;j=null!=b._challengeResponse.nextChallengeHandler?b._challengeResponse.nextChallengeHandler:b.parent.challengeHandler,null!=j&&j.canHandle(i)?j.handle(i,function(a){try{null==a||null==a.credentials?(e.handleClearAuthenticationData(b),e._listener.connectionFailed(b)):(null!=f&&f.resume(),b._challengeResponse=a,e.processConnect(b,h,b._protocol))}catch(c){e.handleClearAuthenticationData(b),e._listener.connectionFailed(b)}}):(this.handleClearAuthenticationData(b),this._listener.connectionFailed(b))},c.processConnect=function(a,b,c){if(null!=a._challengeResponse&&null!=a._challengeResponse.credentials){for(var d=a._challengeResponse.credentials.toString(),e=a.requestHeaders.length-1;e>=0;e--)"Authorization"===a.requestHeaders[e].label&&a.requestHeaders.splice(e,1);for(var f=new B("Authorization",d),e=a.requestHeaders.length-1;e>=0;e--)"Authorization"===a.requestHeaders[e].label&&a.requestHeaders.splice(e,1);a.requestHeaders.push(f),this.handleClearAuthenticationData(a)}this._nextHandler.processConnect(a,b,c)},c.handleAuthenticate=function(a,b,c){a.authenticationReceived=!0,this.handle401(a,b,c)},c.setNextHandler=function(a){this._nextHandler=a;var b=new J(this),c=this;b.authenticationRequested=function(a,b,d){c.handleAuthenticate(a,b,d)},a.setListener(b)},c.setListener=function(a){this._listener=a},b}(Kaazing.Gateway),$=function(){var a=new Z,b=new O,c=new Y,d=function(){this.setNextHandler(a),a.setNextHandler(b),b.setNextHandler(c)},e=d.prototype=new I;return e.processConnect=function(a,b,c){for(var d=[],e=0;e<c.length;e++)d.push(c[e]);var f=a._extensions;f.length>0&&a.requestHeaders.push(new B(x.HEADER_SEC_EXTENSIONS,f.join(";"))),this._nextHandler.processConnect(a,b,d)},e.setNextHandler=function(a){this._nextHandler=a;var b=this,c=new J(this);c.commandMessageReceived=function(a,c){"CloseCommandMessage"==c&&1==a.readyState,b._listener.commandMessageReceived(a,c)},a.setListener(c)},e.setListener=function(a){this._listener=a},d}(),_=function(){var a=function(){},b=a.prototype=new I;return b.processConnect=function(a,b,c){if(a.readyState==db.CLOSED)throw new Error("WebSocket is already closed");this._nextHandler.processConnect(a,b,c)},b.handleConnectionOpened=function(a,b){var c=a;c.readyState==db.CONNECTING&&(c.readyState=db.OPEN,this._listener.connectionOpened(a,b))},b.handleMessageReceived=function(a,b){a.readyState==db.OPEN&&this._listener.textMessageReceived(a,b)},b.handleBinaryMessageReceived=function(a,b){a.readyState==db.OPEN&&this._listener.binaryMessageReceived(a,b)},b.handleConnectionClosed=function(a,b,c,d){var e=a;e.readyState!=db.CLOSED&&(e.readyState=db.CLOSED,this._listener.connectionClosed(a,b,c,d))
},b.handleConnectionFailed=function(a){a.readyState!=db.CLOSED&&(a.readyState=db.CLOSED,this._listener.connectionFailed(a))},b.handleConnectionError=function(a,b){this._listener.connectionError(a,b)},b.setNextHandler=function(a){this._nextHandler=a;var b={},c=this;b.connectionOpened=function(a,b){c.handleConnectionOpened(a,b)},b.redirected=function(a,b){throw new Error("invalid event received")},b.authenticationRequested=function(a,b,c){throw new Error("invalid event received")},b.textMessageReceived=function(a,b){c.handleMessageReceived(a,b)},b.binaryMessageReceived=function(a,b){c.handleBinaryMessageReceived(a,b)},b.connectionClosed=function(a,b,d,e){c.handleConnectionClosed(a,b,d,e)},b.connectionFailed=function(a){c.handleConnectionFailed(a)},b.connectionError=function(a,b){c.handleConnectionError(a,b)},a.setListener(b)},b.setListener=function(a){this._listener=a},a}(),ab=function(){var a=function(a,b,c){this._nativeEquivalent=a,this._handler=b,this._channelFactory=c};return a._strategyMap={},a._strategyChoices={ws:new Array,wss:new Array},a}();!function(){var a="javascript:ws",b="javascript:wss",c=new _,d=new V;c.setNextHandler(d);var e=new M;ab._strategyMap[a]=new ab("ws",c,e),ab._strategyMap[b]=new ab("wss",c,e),ab._strategyChoices.ws.push(a),ab._strategyChoices.wss.push(b)}(),function(){var a="javascript:wse",b="javascript:wse+ssl",c=new _,d=new $;c.setNextHandler(d);var e=new L;ab._strategyMap[a]=new ab("ws",c,e),ab._strategyMap[b]=new ab("wss",c,e),ab._strategyChoices.ws.push(a),ab._strategyChoices.wss.push(b)}();var bb=function(){function a(a){var b={};return b.connectionOpened=function(b,c){a.handleConnectionOpened(b,c)},b.binaryMessageReceived=function(b,c){a.handleMessageReceived(b,c)},b.textMessageReceived=function(a,b){var c=a.parent;c._webSocketChannelListener.handleMessage(c._webSocket,b)},b.connectionClosed=function(b,c,d,e){a.handleConnectionClosed(b,c,d,e)},b.connectionFailed=function(b){a.handleConnectionFailed(b)},b.connectionError=function(b,c){a.handleConnectionError(b,c)},b.authenticationRequested=function(a,b,c){},b.redirected=function(a,b){},b.onBufferedAmountChange=function(b,c){a.handleBufferedAmountChange(b,c)},b}var b=!0,c={};if(Object.defineProperty)try{Object.defineProperty(c,"prop",{get:function(){return!0}}),b=!1}catch(d){}var f=function(){this._handlerListener=a(this)},g=f.prototype;return g.initDelegate=function(a,b){var c=ab._strategyMap[b];c._handler.setListener(this._handlerListener);var d=c._channelFactory,e=a._location,f=d.createChannel(e,a._protocol);a._selectedChannel=f,f.parent=a,f._extensions=a._extensions,f._handler=c._handler,f._handler.processConnect(a._selectedChannel,e,a._protocol)},g.fallbackNext=function(a){var b=a.getNextStrategy();null==b?this.doClose(a,!1,1006,""):this.initDelegate(a,b)},g.doOpen=function(a,c){void 0!==a._lastErrorEvent&&delete a._lastErrorEvent,a.readyState===db.CONNECTING&&(a.readyState=db.OPEN,b&&(a._webSocket.readyState=db.OPEN),a._webSocketChannelListener.handleOpen(a._webSocket,c))},g.doClose=function(a,c,d,e){void 0!==a._lastErrorEvent&&a._webSocketChannelListener.handleError(a._webSocket,a._lastErrorEvent),(a.readyState===db.CONNECTING||a.readyState===db.OPEN||a.readyState===db.CLOSING)&&(a.readyState=db.CLOSED,b&&(a._webSocket.readyState=db.CLOSED),a._webSocketChannelListener.handleClose(a._webSocket,c,d,e))},g.doBufferedAmountChange=function(a,b){a._webSocketChannelListener.handleBufferdAmountChange(a._webSocket,b)},g.processConnect=function(a,b,c){var d=a;if(d.readyState===db.OPEN)throw new Error("Attempt to reconnect an existing open WebSocket to a different location");var e=d._compositeScheme;if("ws"!=e&&"wss"!=e){var f=ab._strategyMap[e];if(null==f)throw new Error("Invalid connection scheme: "+e);d._connectionStrategies.push(e)}else{var g=ab._strategyChoices[e];if(null==g)throw new Error("Invalid connection scheme: "+e);for(var h=0;h<g.length;h++)d._connectionStrategies.push(g[h])}this.fallbackNext(d)},g.processTextMessage=function(a,b){var c=a;if(c.readyState!=db.OPEN)throw new Error("Attempt to post message on unopened or closed web socket");var d=c._selectedChannel;d._handler.processTextMessage(d,b)},g.processBinaryMessage=function(a,b){var c=a;if(c.readyState!=db.OPEN)throw new Error("Attempt to post message on unopened or closed web socket");var d=c._selectedChannel;d._handler.processBinaryMessage(d,b)},g.processClose=function(a,c,d){var e=a;(a.readyState===db.CONNECTING||a.readyState===db.OPEN)&&(a.readyState=db.CLOSING,b&&(a._webSocket.readyState=db.CLOSING));var f=e._selectedChannel;f._handler.processClose(f,c,d)},g.setListener=function(a){this._listener=a},g.handleConnectionOpened=function(a,b){var c=a.parent;this.doOpen(c,b)},g.handleMessageReceived=function(a,b){var c=a.parent;switch(c.readyState){case db.OPEN:if("blob"===c._webSocket.binaryType&&b.constructor==e.ByteBuffer)b=b.getBlob(b.remaining());else if("arraybuffer"===c._webSocket.binaryType&&b.constructor==e.ByteBuffer)b=b.getArrayBuffer(b.remaining());else if("blob"===c._webSocket.binaryType&&b.byteLength)b=new Blob([new Uint8Array(b)]);else if("bytebuffer"===c._webSocket.binaryType&&b.byteLength){for(var d=new Uint8Array(b),f=[],g=0;g<d.byteLength;g++)f.push(d[g]);b=new e.ByteBuffer(f)}else if("bytebuffer"===c._webSocket.binaryType&&b.size){var i=function(a){var b=new e.ByteBuffer;b.putBytes(a),b.flip(),c._webSocketChannelListener.handleMessage(c._webSocket,b)};return void h.asNumberArray(i,data)}c._webSocketChannelListener.handleMessage(c._webSocket,b);break;case db.CONNECTING:case db.CLOSING:case db.CLOSED:break;default:throw new Error("Socket has invalid readyState: "+$this.readyState)}},g.handleConnectionClosed=function(a,b,c,d){var e=a.parent;e.readyState!==db.CONNECTING||a.authenticationReceived||a.preventFallback?this.doClose(e,b,c,d):this.fallbackNext(e)},g.handleConnectionFailed=function(a){var b=a.parent,c=1006,d="";a.closeReason.length>0&&(c=a.closeCode,d=a.closeReason),b.readyState!==db.CONNECTING||a.authenticationReceived||a.preventFallback?this.doClose(b,!1,c,d):this.fallbackNext(b)},g.handleConnectionError=function(a,b){a.parent._lastErrorEvent=b},f}();!function(a){a.HttpRedirectPolicy=function(){function a(a,c){if(b(a,c))return!0;var d=a.scheme.toLowerCase(),f=c.scheme.toLowerCase();if(-1==f.indexOf(d))return!1;var g=a.host,h=c.host,i=e(g),j=e(h);return-1==h.indexOf(i,h.length-i.length)?!1:-1==g.indexOf(j,g.length-j.length)?!1:!0}function b(a,b){if(c(a,b))return!0;var d=a.scheme.toLowerCase(),e=b.scheme.toLowerCase();if(-1==e.indexOf(d))return!1;var f=a.host.toLowerCase(),g=b.host.toLowerCase();return f==g?!0:!1}function c(a,b){var c=a.scheme.toLowerCase(),d=b.scheme.toLowerCase(),e=a.authority.toLowerCase(),f=b.authority.toLowerCase();return c==d&&e==f?!0:!1}function d(a,c){if(b(a,c))return!0;var d=a.scheme.toLowerCase(),e=c.scheme.toLowerCase();if(-1==e.indexOf(d))return!1;var f=a.host.toLowerCase(),g=c.host.toLowerCase();if(g.length<f.length)return!1;var h="."+f;return-1==g.indexOf(h,g.length-h.length)?!1:!0}function e(a){var b=a.split("."),c=b.length;if(2>=c)return a;for(var d="",e=1;c>e;e++)d+="."+b[e];return d}var f=function(a){if(arguments.length<1){var b="HttpRedirectPolicy: Please specify the policy name.";throw Error(b)}if("undefined"==typeof a){var b="HttpRedirectPolicy: Please specify required 'name' parameter.";throw Error(b)}if("string"!=typeof a){var b="HttpRedirectPolicy: Required parameter 'name' is a string.";throw Error(b)}this.name=a},g=f.prototype;return g.toString=function(){return"HttpRedirectPolicy."+this.name},g.isRedirectionAllowed=function(e,f){if(arguments.length<2){var g="HttpRedirectPolicy.isRedirectionAllowed(): Please specify both the 'originalLoc' and the 'redirectLoc' parameters.";throw Error(g)}if("undefined"==typeof e){var g="HttpRedirectPolicy.isRedirectionAllowed(): Please specify required 'originalLoc' parameter.";throw Error(g)}if("string"!=typeof e){var g="HttpRedirectPolicy.isRedirectionAllowed(): Required parameter 'originalLoc' is a string.";throw Error(g)}if("undefined"==typeof f){var g="HttpRedirectPolicy.isRedirectionAllowed(): Please specify required 'redirectLoc' parameter.";throw Error(g)}if("string"!=typeof f){var g="HttpRedirectPolicy.isRedirectionAllowed(): Required parameter 'redirectLoc' is a string.";throw Error(g)}var h=!1,i=new URI(e.toLowerCase().replace("http","ws")),j=new URI(f.toLowerCase().replace("http","ws"));switch(this.name){case"ALWAYS":h=!0;break;case"NEVER":h=!1;break;case"PEER_DOMAIN":h=a(i,j);break;case"SAME_DOMAIN":h=b(i,j);break;case"SAME_ORIGIN":h=c(i,j);break;case"SUB_DOMAIN":h=d(i,j);break;default:var g="HttpRedirectPolicy.isRedirectionAllowed(): Invalid policy: "+this.name;throw new Error(g)}return h},f.ALWAYS=new f("ALWAYS"),f.NEVER=new f("NEVER"),f.PEER_DOMAIN=new f("PEER_DOMAIN"),f.SAME_DOMAIN=new f("SAME_DOMAIN"),f.SAME_ORIGIN=new f("SAME_ORIGIN"),f.SUB_DOMAIN=new f("SUB_DOMAIN"),f}()}(Kaazing.Gateway);var cb=Kaazing.Gateway.HttpRedirectPolicy;!function(a,b){var e=new bb;b.WebSocket=function(){function f(a){if(a.onmessage=null,a.onopen=null,a.onclose=null,a.onerror=null,Object.defineProperty)try{Object.defineProperty(a,"readyState",{get:function(){return a._channel?a._channel.readyState:i.CLOSED},set:function(){throw new Error("Cannot set read only property readyState")}});var b="blob";Object.defineProperty(a,"binaryType",{enumerable:!0,configurable:!0,get:function(){return b},set:function(a){if("blob"!==a&&"arraybuffer"!==a&&"bytebuffer"!==a)throw new SyntaxError("Invalid binaryType. Valid values are 'blob', 'arraybuffer' and 'bytebuffer'");b=a}}),Object.defineProperty(a,"bufferedAmount",{get:function(){return a._channel.getBufferedAmount()},set:function(){throw new Error("Cannot set read only property bufferedAmount")}})}catch(c){a.readyState=i.CONNECTING,a.binaryType="blob",a.bufferedAmount=0}else a.readyState=i.CONNECTING,a.binaryType="blob",a.bufferedAmount=0}var h={},i=function(a,b,c,d,e,g){this.url=a,this.protocol=b,this.extensions=c||[],this.connectTimeout=0,this._challengeHandler=d,this._redirectPolicy=cb.ALWAYS,"undefined"!=typeof e&&(n(e),this.connectTimeout=e),"undefined"!=typeof g&&(o(g),this._redirectPolicy=g),this._queue=[],this._origin="",this._eventListeners={},f(this),l(this,this.url,this.protocol,this.extensions,this._challengeHandler,this.connectTimeout)},j=function(a){if(0==a.length)return!1;for(var b="()<>@,;:\\<>/[]?={}	 \n",c=0;c<a.length;c++){var d=a.substr(c,1);if(-1!=b.indexOf(d))return!1;var e=a.charCodeAt(c);if(33>e||e>126)return!1}return!0},k=function(a){if("undefined"==typeof a)return!0;if("string"==typeof a)return j(a);for(var b=0;b<a.length;b++)if(!j(a[b]))return!1;return!0},l=function(a,b,c,d,f,g){if(!k(c))throw new Error("SyntaxError: invalid protocol: "+c);var j=new E(b);if(!j.isSecure()&&"https:"===document.location.protocol)throw new Error("SecurityException: non-secure connection attempted from secure origin");var l=[];if("undefined"!=typeof c&&("string"==typeof c&&c.length?l=[c]:c.length&&(l=c)),a._channel=new N(j,l),a._channel._webSocket=a,a._channel._webSocketChannelListener=h,a._channel._extensions=d,"undefined"!=typeof f&&(a._channel.challengeHandler=f),"undefined"!=typeof g&&g>0){var m=a._channel,n=new F(function(){m.readyState==i.CONNECTING&&(e.doClose(m,!1,1006,"Connection timeout"),e.processClose(m,0,"Connection timeout"),m.connectTimer=null)},g,!1);a._channel.connectTimer=n,n.start()}e.processConnect(a._channel,j.getWSEquivalent())},m=i.prototype;m.send=function(a){switch(this.readyState){case 0:throw new Error("Attempt to send message on unopened or closed WebSocket");case 1:"string"==typeof a?e.processTextMessage(this._channel,a):e.processBinaryMessage(this._channel,a);break;case 2:case 3:break;default:throw new Error("Illegal state error")}},m.close=function(b,c){if("undefined"!=typeof b&&1e3!=b&&(3e3>b||b>4999)){var d=new Error("code must equal to 1000 or in range 3000 to 4999");throw d.name="InvalidAccessError",d}if("undefined"!=typeof c&&c.length>0){var f=new a.ByteBuffer;if(f.putString(c,g.UTF8),f.flip(),f.remaining()>123)throw new SyntaxError("SyntaxError: reason is longer than 123 bytes")}switch(this.readyState){case 0:case 1:e.processClose(this._channel,b,c);break;case 2:case 3:break;default:throw new Error("Illegal state error")}},m.getChallengeHandler=function(){return this._challengeHandler||null},m.setChallengeHandler=function(a){if("undefined"==typeof a){var b="WebSocket.setChallengeHandler(): Parameter 'challengeHandler' is required";throw new Error(b)}this._challengeHandler=a,this._channel.challengeHandler=a},m.getRedirectPolicy=function(){return this._redirectPolicy},m.setRedirectPolicy=function(a){o(a),this._redirectPolicy=a};var n=function(a){if("undefined"==typeof a){var b="WebSocket.setConnectTimeout(): int parameter 'connectTimeout' is required";throw new Error(b)}if("number"!=typeof a){var b="WebSocket.setConnectTimeout(): connectTimeout should be an integer";throw new Error(b)}if(0>a){var b="WebSocket.setConnectTimeout(): Connect timeout cannot be negative";throw new Error(b)}},o=function(a){if("undefined"==typeof a){var c="WebSocket.validateHttpRedirectPolicy(): Parameter 'redirectPolicy' is required";throw new Error(c)}if(!(a instanceof b.HttpRedirectPolicy)){var c="WebSocket.validateHttpRedirectPolicy(): Parameter 'redirectPolicy' must be of type Kaazing.Gateway.HttpRedirectPolicy";throw new Error(c)}},p=function(a,b){var c=new d(a,b,a._origin);a.dispatchEvent(c)},q=function(a){for(var b=(new Date).getTime(),c=b+50;a._queue.length>0;){if((new Date).getTime()>c)return void setTimeout(function(){q(a)},0);var d=a._queue.shift(),e=!1;try{if(a.readyState!=i.OPEN)return void(a._queue=[]);p(a,d),e=!0}finally{e||(0==a._queue.length?a._delivering=!1:setTimeout(function(){q(a)},0))}}a._delivering=!1},r=function(a,b,d,e){delete a._channel,setTimeout(function(){var f=new c(a,b,d,e);a.dispatchEvent(f)},0)};return h.handleOpen=function(a,b){a.protocol=b;var c={type:"open",bubbles:!0,cancelable:!0,target:a};a.dispatchEvent(c)},h.handleMessage=function(a,b){if(!Object.defineProperty&&"string"!=typeof b){var c=a.binaryType;if("blob"!==c&&"arraybuffer"!==c&&"bytebuffer"!==c){var d={type:"error",bubbles:!0,cancelable:!0,target:a,message:"Invalid binaryType. Valid values are 'blob', 'arraybuffer' and 'bytebuffer'"};return void a.dispatchEvent(d)}}a._queue.push(b),a._delivering||(a._delivering=!0,q(a))},h.handleClose=function(a,b,c,d){r(a,b,c,d)},h.handleError=function(a,b){setTimeout(function(){a.dispatchEvent(b)},0)},h.handleBufferdAmountChange=function(a,b){a.bufferedAmount=b},m.addEventListener=function(a,b,c){this._eventListeners[a]=this._eventListeners[a]||[],this._eventListeners[a].push(b)},m.removeEventListener=function(a,b,c){var d=this._eventListeners[a];if(d)for(var e=0;e<d.length;e++)if(d[e]==b)return void d.splice(e,1)},m.dispatchEvent=function(a){var b=a.type;if(!b)throw new Error("Cannot dispatch invalid event "+a);try{var c=this["on"+b];"function"==typeof c&&c(a)}catch(a){}var d=this._eventListeners[b];if(d)for(var e=0;e<d.length;e++)try{d[e](a)}catch(f){}},i.CONNECTING=m.CONNECTING=0,i.OPEN=m.OPEN=1,i.CLOSING=m.CLOSING=2,i.CLOSED=m.CLOSED=3,i}()}(Kaazing,Kaazing.Gateway);var db=f.WebSocket;!function(a){a.WebSocketFactory=function(){var b=function(){this.extensions={},this.redirectPolicy=a.HttpRedirectPolicy.ALWAYS},c=b.prototype;return c.getExtension=function(a){return this.extensions[a]},c.setExtension=function(a){this.extensions[a.name]=a},c.setChallengeHandler=function(a){if("undefined"==typeof a){var b="WebSocketFactory.setChallengeHandler(): Parameter 'challengeHandler' is required";throw new Error(b)}this.challengeHandler=a},c.getChallengeHandler=function(){return this.challengeHandler||null},c.createWebSocket=function(a,b){var c=[];for(var d in this.extensions)this.extensions.hasOwnProperty(d)&&this.extensions[d].enabled&&c.push(this.extensions[d].toString());var e=this.getChallengeHandler(),f=this.getDefaultConnectTimeout(),g=this.getDefaultRedirectPolicy(),h=new db(a,b,c,e,f,g);return h},c.setDefaultConnectTimeout=function(a){if("undefined"==typeof a){var b="WebSocketFactory.setDefaultConnectTimeout(): int parameter 'connectTimeout' is required";throw new Error(b)}if("number"!=typeof a){var b="WebSocketFactory.setDefaultConnectTimeout(): connectTimeout should be an integer";throw new Error(b)}if(0>a){var b="WebSocketFactory.setDefaultConnectTimeout(): Connect timeout cannot be negative";throw new Error(b)}this.connectTimeout=a},c.getDefaultConnectTimeout=function(){return this.connectTimeout||0},c.setDefaultRedirectPolicy=function(b){if("undefined"==typeof b){var c="WebSocketFactory.setDefaultRedirectPolicy(): int parameter 'redirectPolicy' is required";throw new Error(c)}if(!(b instanceof a.HttpRedirectPolicy)){var c="WebSocketFactory.setDefaultRedirectPolicy(): redirectPolicy should be an instance of HttpRedirectPolicy";throw new Error(c)}this.redirectPolicy=b},c.getDefaultRedirectPolicy=function(){return this.redirectPolicy},b}()}(Kaazing.Gateway);var eb=Kaazing.Gateway.WebSocketFactory;"function"==typeof define&&define.amd&&define([],function(){return f})}();